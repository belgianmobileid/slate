
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>itsme® OpenID Connect documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="qes" data-languages="[&quot;http&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="http">HTTP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#1-introduction" class="toc-h1 toc-link" data-title="1-introduction">1. Introduction</a>
          </li>
          <li>
            <a href="#2-prerequisites" class="toc-h1 toc-link" data-title="2-prerequisites">2. Prerequisites</a>
          </li>
          <li>
            <a href="#3-integrating-sign-services" class="toc-h1 toc-link" data-title="3-integrating-sign-services">3. Integrating Sign services</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#3-1-checking-itsme-sign-configuration" class="toc-h2 toc-link" data-title="3-1-checking-itsme-sign-configuration">3.1. Checking itsme® Sign configuration</a>
                  </li>
                  <li>
                    <a href="#3-2-starting-a-new-user-identification-session" class="toc-h2 toc-link" data-title="3-2-starting-a-new-user-identification-session">3.2. Starting a new User identification session</a>
                  </li>
                  <li>
                    <a href="#3-3-capturing-the-identification-response" class="toc-h2 toc-link" data-title="3-3-capturing-the-identification-response">3.3. Capturing the Identification Response</a>
                  </li>
                  <li>
                    <a href="#3-4-requesting-the-user-identification-session-status" class="toc-h2 toc-link" data-title="3-4-requesting-the-user-identification-session-status">3.4. Requesting the User identification session status</a>
                  </li>
                  <li>
                    <a href="#3-5-getting-the-user-identification-status-info" class="toc-h2 toc-link" data-title="3-5-getting-the-user-identification-status-info">3.5. Getting the User identification status info</a>
                  </li>
                  <li>
                    <a href="#3-6-processing-a-sign-request" class="toc-h2 toc-link" data-title="3-6-processing-a-sign-request">3.6. Processing a Sign Request</a>
                  </li>
                  <li>
                    <a href="#3-7-managing-the-sign-response" class="toc-h2 toc-link" data-title="3-7-managing-the-sign-response">3.7. Managing the Sign Response</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#4-appendixes" class="toc-h1 toc-link" data-title="4-appendixes">4. Appendixes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#4-1-handling-error-response" class="toc-h2 toc-link" data-title="4-1-handling-error-response">4.1. Handling Error Response</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a> --></li>
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='1-introduction'>1. Introduction</h1>
<p>itsme® is a trusted identity provider allowing partners to use verified identities for authentication and authorization on web desktop, mobile web and mobile applications. </p>

<p>The objective of this document is to provide all the information needed to integrate the <strong>Sign</strong> service. </p>

<p>At this moment only the Hash Signing variant is available and documented. In this variant, a remote Signature Creation Application (SCA) will provide the WYSIWYS experience to the User, provide the hash of the data to be signed to the itsme® service and use the returned digital signature value to format the signature in one of the AdES formats.</p>

<p><a name="Onboarding"></a></p>
<h1 id='2-prerequisites'>2. Prerequisites</h1>
<p>Before you can integrate your application with itsme® service, you MUST set up a project in the <a href="https://brand.belgianmobileid.be/d/CX5YsAKEmVI7" target="blank">itsme® B2B portal</a> to obtain all the needed information.</p>
<h1 id='3-integrating-sign-services'>3. Integrating Sign services</h1>
<p>The itsme® Sign flow goes through the steps shown in the sequence diagram below. </p>

<p><img src="QES_Hash_Signing_SeqDiag.png" alt="Sequence diagram describing the QES Hash Signing flow" /></p>

<ol>
  <li>The User indicates on your end he wishes to sign a document with itsme®</li>
  <li>Your web desktop, mobile web or mobile SCA application sends a request to itsme® Integration Layer Back-End in order to create the User’s Identification session and obtain the User’s signing certificate to be include in the data to be signed.</li>
  <li>itsme® returns the session id and the redirect URL specific to the User to your SCA Back-End.</li>
  <li>Your SCA Front-End redirect the User to the Integration Layer Front-End of itsme®, meaning that the Iser will be authenticated in the meanwhile. If the User has no signature certificate yet, the certificate creation process will be initiated automatically.</li>
  <li>Finally, when the User is authenticated and has a signature certificate, he is redirected to the your SCA Front-End. The redirection to your SCA Front-End should be (almost) transparent to the User (aka possible displaying of a spinner) as the laps of time between step 5 and step 11 of this diagram should be extremely short.</li>
  <li>Your SCA Back-End contacts the itsme® Integration Layer Back-End to get the signature certificate of the User.</li>
</ol>

<aside class="alert">Currently we only allow the signature of one single hash. Multiple hash signing is not yet available.</aside>

<ol>
  <li value="7">The itsme® Integration Layer Back-End returns your SCA Back-End the signer information as well as the signature certificate of the User.</li>
  <li>Your SCA Back-End constructs the data to be signed and the hash of the signature will be computed by yourself. The value of this hash MUST be base64url encoded.</li> 
  <li>Your SCA Back-End will provide the hash to the itsme® Integration Layer Back-End to request the digital signature value.</li>
  <li>A session id and redirect URL are returned by itsme® to your SCA Back-End.</li>
  <li>Your SCA frontend will then redirect the User to the signature webpage of itsme®, where some explanations about how to process the signature are displayed. Before being able to confirm the signature with the itsme® App, the User will also need to perform a security check, known as poka yoke, is also shown to the User. This consists of three icons that are displayed in the signature webpage, of which one is highlighted in tangerine. The User must make sure that the sequence of three icons displayed his App is the same as the one displayed in the signature webpage. To continue the confirmation of the action, the User must select in his App the icon that is highlighted in tangerine on the signature webpage.</li>    
  <li>The session of the User at itsme® side ends as the process is finished and the User is redirected to your SCA Front-End.</li>
  <li>Your SCA Back-End will contact the itsme® Integration Layer Back-End to check the signature status.</li>
  <li>itsme® then returns the signature completion status and the digital signature value.</li>
  <li>At this stage, your SCA is able to confirm the success of the operation and display a success message.</li>
</ol>

<p><a name="OpenIDQES"></a></p>
<h2 id='3-1-checking-itsme-sign-configuration'>3.1. Checking itsme® Sign configuration</h2>
<p>To simplify implementations and increase flexibility, all needed key-value pairs about itsme® configuration can be retrieved from a JSON document, such as</p>

<ul>
  <li>the signature policies</li>
  <li>commitment types</li>
  <li>supported languages</li>
  <li>...</li>
</ul>

<p>The JSON document for itsme® Sign service may be retrieved from: </p>

<table><thead>
<tr>
<th style="text-align: left">Environment</th>
<th style="text-align: left">URL</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>SANDBOX</strong></td>
<td style="text-align: left">https://uatb2b.sixdots.be/qes-partners/1.0.0/.well-known/configuration</td>
</tr>
<tr>
<td style="text-align: left"><strong>PRODUCTION</strong></td>
<td style="text-align: left">https://b2b.sixdots.be/qes-partners/1.0.0/.well-known/configuration</td>
</tr>
</tbody></table>
<h2 id='3-2-starting-a-new-user-identification-session'>3.2. Starting a new User identification session</h2>
<p>First, you will forg a HTTPS POST request that MUST be sent to the itsme® User Identification Endpoint. The itsme® User Identification Endpoint can be retrieved from the <a href="#OpenIDQES">itsme® JSON document</a>, using the key <code>user_identification</code>.</p>

<p>Below you will find a number of mandatory and recommended parameters to integrate in the HTTPS POST query string:</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">POST</span> <span class="nn">/https://uatb2b.sixdots.be/qes-partners/1.0.0/user_identification</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">{</span>
<span class="s">    "partnerCode":"myClientID", </span>
<span class="s">    "serviceCode":"myServiceCode", </span>
<span class="s">    "redirectUrl":"myServiceRedirectUrl",</span>
<span class="s">    "lang":"FR"</span>
<span class="s">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>partnerCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be the client identifier you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>userCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">An identifier for the User, unique among all itsme® accounts and never reused. Use <code>userCode</code> in the application as the unique-identifier key for the User.</td>
</tr>
<tr>
<td style="text-align: left"><strong>serviceCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter allows the application to express the desired scope. It MUST contain the value <code>service:service_code</code>, the itsme® service you want to use as defined for your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>lang</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameters defines the recommended language to be used for GUI interaction. If the parameter is not defined in the request, then the language that will be used is the one of the cookie. This defaults to the language used in the browser if there is no cookie.</td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the URI to which the User will be redirected to your remote SCA. This MUST exactly match the redirect URI of the specified service defined when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
</tbody></table>
<h2 id='3-3-capturing-the-identification-response'>3.3. Capturing the Identification Response</h2><h3 id='capturing-a-successful-identification-code'>Capturing a successful Identification Code</h3>
<p>If the User is successfully authenticated and authorizes access to the Identification Request, itsme® will return a response to your server component. This is achieved by returning an Identification Response to the <code>redirect_uri</code> specified previously in the Identification Request.</p>
<pre class="highlight http tab-http--inline"><code><span class="err">{
    "status": "OK",
    "asyncRespId": "4kpr55zdi2mk9ns27awgngkltoenfy04gi9b",
    "identificationUrl": "https://uatmerchant.itsme.be/qes/identify_yourself?language=FR&amp;q=ss4liz8kjk1xxz8taj3nbxae7zqty6eq"
}
</span></code></pre>
<p>The response will contain:</p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>status</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">It is the status of User Identification Request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>statusReason</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">It explains the reason of a failure. No reason is given in case the request status is pending or success.</td>
</tr>
<tr>
<td style="text-align: left"><strong>asyncRespId</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This parameter is the identifier of a User identification session.</td>
</tr>
<tr>
<td style="text-align: left"><strong>identificationUrl</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This is the itsme® URL of the signature welcome page. On this webpage the User will identify himself by entering his mobile phone number.</td>
</tr>
</tbody></table>
<h3 id='handling-error-response'>Handling Error Response</h3>
<p>See <a href="#RequestObjectByValue">Appendixes</a> to get more information on the error codes.</p>
<h2 id='3-4-requesting-the-user-identification-session-status'>3.4. Requesting the User identification session status</h2>
<p>By calling the Identification Session Status Endpoint, you are checking the status of the User identification session. </p>

<p>Below you will find a number of mandatory and recommended parameters to integrate in the HTTPS POST query string:</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">POST</span> <span class="nn">/https://uatb2b.sixdots.be/qes-partners/1.0.0/user_identification/status</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">{</span>
<span class="s">    "partnerCode":"myPartnerCode", </span>
<span class="s">    "serviceCode":"myServiceCode", </span>
<span class="s">    "asyncRespID":"4kpr55zdi2mk9ns27awgngkltoenfy04gi9b"</span>
<span class="s">}</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>partnerCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be the client identifier you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>serviceCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter allows the application to express the desired scope. It MUST contain the value <code>service:service_code</code>, the itsme® service you want to use as defined for your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>asyncRespId</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter is the identifier of a User identification session. This value can be retrieved from the values obtained in the Identification Response.</td>
</tr>
</tbody></table>
<h2 id='3-5-getting-the-user-identification-status-info'>3.5. Getting the User identification status info</h2>
<p>If the Identification Session Status Request has been sucessfully validated we will return an HTTP 200 OK response as in the example aside. In other words, you will get the confirmation that the User can perform a Sign transaction with itsme® and retrieve the User certificate reference value.</p>

<p>The response body will include the following values:</p>
<pre class="highlight http tab-http--inline"><code><span class="err">{
    "status": "OK",
    "userCode": "9o8f04wm1g0bdc8gmgcuxp2ehgn7txh0x2kq",
    "certificate": "user-certificate"
}
</span></code></pre>
<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>status</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">It is the status of User Identification Request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>userCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">An identifier for the User, unique among all itsme® accounts and never reused. Use <code>userCode</code> in the application as the unique-identifier key for the User.</td>
</tr>
<tr>
<td style="text-align: left"><strong>certificate</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h2 id='3-6-processing-a-sign-request'>3.6. Processing a Sign Request</h2>
<p>This request has to be created in order to get the information about the Sign session. </p>

<p>Below you will find the minimal set of parameters required for processing the HTTPS POST query string:</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">POST</span> <span class="nn">/https://uatb2b.sixdots.be/qes-partners/1.0.0/sign_document</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">{</span>
<span class="s">    "inDocs": {</span>
<span class="s">        "docHash":[</span>
<span class="s">            {</span>
<span class="s">                "di":[</span>
<span class="s">                    {</span>
<span class="s">                        "alg":"http://www.w3.org/2001/04/xmlenc#sha256",</span>
<span class="s">                        "value":"f4OxZX/x/FO5LcGBSKHWXfwtSx+j1ncoSt3SABJtkGk="</span>
<span class="s">                    }</span>
<span class="s">                ],</span>
<span class="s">                "id":"ContractCar20180914u89236456.pdf"</span>
<span class="s">            }</span>
<span class="s">        ]</span>
<span class="s">    },</span>
<span class="s">    "reqID": "ReqID4va0acsef3mv5ft1dp71",</span>
<span class="s">    "asyncRespID": null,</span>
<span class="s">    "optInp": {</span>
<span class="s">        "profile": [</span>
<span class="s">            "urn:be:itsme:dss:1.0",</span>
<span class="s">            "urn:oasis:names:tc:dss:1.0:profiles:asynchronousprocessing",</span>

        ],
    "policy": [],
    "lang": "FR",
    "nonce": null,
    "sigAlgo": null,
    "itsme": {
      "signer": {
        "userCode": "9o8f04wm1g0bdc8gmgcuxp2ehgn7txh0x2kq"
      },
      "partnerCode": "myPartnerCode",
      "serviceCode": "myServiceCode",
      "description": [
        {
          "lang": "EN",
          "value": "Car insurance contract"
        },
        {
          "lang": "FR",
          "value": "Contrat d’assurance voiture"
        },
        {
          "lang": "NL",
          "value": "Contract verzekering auto"
        },
        {
          "lang": "DE",
          "value": "Kfz-Versicherungsvertrag"
        }
      ],
      "callbackUrl": null,
      "redirectUrl": "myServiceRedirectUrl",
      "expiryTimestamp": null,
      "legalNotice": null,
      "signPolicy": {
        "signPolicyRef": "ITSME_DEFAULT",
        "commitmentTypeRef":"1.2.840.113549.1.9.16.6.5",
        "signerRole": [
          {
            "lang": "EN",
            "value": "General Manager"
          },
          {
            "lang": "FR",
            "value": "Gestionnaire"
          },
          {
            "lang": "NL",
            "value": "Zaakvoerder"
          },
          {
            "lang": "DE",
            "value": "Manager"
          }
        ]
      }
    }
  }
}
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>inDocs</strong></td>
<td style="text-align: left"></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This contains the element to be signed.</td>
</tr>
<tr>
<td style="text-align: left"><strong>docHash</strong></td>
<td style="text-align: left"></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter defines the list of hashes to be signed by itsme®, one item per hash.</td>
</tr>
<tr>
<td style="text-align: left"><strong>id</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the ID of the hash(es) to be signed. You should provide us this information when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>. Currently, only single hash signing is allowed.</td>
</tr>
<tr>
<td style="text-align: left"><strong>di</strong></td>
<td style="text-align: left">Array</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the Table of hashes to be signed during the signature process.</td>
</tr>
<tr>
<td style="text-align: left"><strong>alg</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Only the SHA256 algorithm is supported. See <a href="http://www.w3.org/2001/04/xmlenc#sha256" target="blank">http://www.w3.org/2001/04/xmlenc#sha256</a> for more information.</td>
</tr>
<tr>
<td style="text-align: left"><strong>value</strong></td>
<td style="text-align: left">Array</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the hash to be signed during the signature flow. The value of the hash computed must be given in Base64.</td>
</tr>
<tr>
<td style="text-align: left"><strong>reqID</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the ID of the request that you transfer.</td>
</tr>
<tr>
<td style="text-align: left"><strong>asyncRespId</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter is the identifier of a User identification session. This value can be retrieved from the values obtained in the Identification Response. In case no <code>asyncRespID</code> is given in the request, a new session is created.</td>
</tr>
<tr>
<td style="text-align: left"><strong>optInp</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">Those are additional information needed for the signature request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>lang</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameters defines the recommended language to be used for GUI interaction. If the parameter is not defined in the request, then the language that will be used is the one of the cookie. This defaults to the language used in the browser if there is no cookie.</td>
</tr>
<tr>
<td style="text-align: left"><strong>itsme</strong></td>
<td style="text-align: left"></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter contains all the information related to itsme® context.</td>
</tr>
<tr>
<td style="text-align: left"><strong>signer</strong></td>
<td style="text-align: left">DssISigner</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is all the information that allows identification of the User in itsme®.</td>
</tr>
<tr>
<td style="text-align: left"><strong>partnerCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be the client identifier you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>serviceCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This parameter allows the application to express the desired scope. It MUST contain the value <code>service:service_code</code>, the itsme® service you want to use as defined for your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the URI to which the User will be redirected to your remote SCA. This MUST exactly match the redirect URI of the specified service defined when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>signPolicy</strong></td>
<td style="text-align: left">DssISignPolicy</td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the object of the Signature policy to be used during the Signature. This parameter contains all the information related to the signature policy.</td>
</tr>
<tr>
<td style="text-align: left"><strong>signPolicyRef</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This defines the reference of the signature policy to be used during itsme® Signing flow. In case no specific signature policy is applicable for that specific use case, the itsme® generic qualified signature policy should be used. The signature policy has to be indicated in the SCA Front-End to the User. The list of available codes can be retrieved from the <a href="#OpenIDQES">JSON document</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>commitmentTypeRef</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This defines the reference of the commitment type to be used during itsme® Signing flow. This parameter is used to display (in the itsme® App) the commitment type of the signature to the User. There is no commitment type by default. If the parameter is not given by the SCA, then nothing is displayed in the itsme® App. You should use a code that corresponds to a specific commitment type. The list of available codes can be retrieved from the <a href="#OpenIDQES">JSON document</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>signerRole</strong></td>
<td style="text-align: left">Array</td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This defines the role of the signer. This information is displayed in the itsme® App to show to the signer under which role he will sign the document. If no signer role is provided nothing will be displayed in the itsme® App.</td>
</tr>
</tbody></table>

<p>This parameter is optional and freely defined in a free text of maximum 50 characters by yourself. You should provide this free text in all supported languages. The characters used to define the Signer Role MUST be ISO-8859-1 compatible.  </p>
<h2 id='3-7-managing-the-sign-response'>3.7. Managing the Sign Response</h2><h3 id='getting-a-successful-sign-response'>Getting a successful Sign Response</h3>
<p>If the Sign Request has been sucessfully validated we will return an HTTP 200 OK response as in the example aside.</p>

<p>The response body will include the following values:</p>
<pre class="highlight http tab-http--inline"><code><span class="err">{
    "result": {
        "maj": "urn:oasis:names:tc:dss:1.0:profiles:asynchronousprocessing:resultmajor:Pending"
    },
    "reqID": "ReqID4va0acsef3mv5ft1dp71",
    "respID": "hjg3ngu3tvvv71k9qg1vyokc2mwmqgqk43iv",
    "optOutp": {
        "itsme": {
            "signingUrl": "https://uatmerchant.itsme.be/qes/prove_its_you_poka?q=34u5jh2dltb1xhsu0g4bshnlziycdhow&amp;language=FR"
        }
    }
}
</span></code></pre>
<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Type</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>result</strong></td>
<td style="text-align: left"></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This is the status of the request (pending, success or failure).</td>
</tr>
<tr>
<td style="text-align: left"><strong>maj</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This is a general message that will give the status of the request, pending, success or error. In case of failure, the root cause is given.</td>
</tr>
<tr>
<td style="text-align: left"><strong>min</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This is a specific message that, in case of failure, identifies the root cause of the failure.</td>
</tr>
<tr>
<td style="text-align: left"><strong>msg</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This indicates the origin of the error.</td>
</tr>
<tr>
<td style="text-align: left"><strong>reqID</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left">Always</td>
<td style="text-align: left">This is the ID of the request that you transfer.</td>
</tr>
<tr>
<td style="text-align: left"><strong>asyncRespId</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">This parameter is the identifier of a User identification session.</td>
</tr>
<tr>
<td style="text-align: left"><strong>optOutp</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">Those are additional information needed for the signature request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>itsme</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">This value contains all the information related to itsme® context.</td>
</tr>
<tr>
<td style="text-align: left"><strong>signingUrl</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">This signing URL is the link to redirect the User from the SCA frontend  to the itsme® Signing Page.</td>
</tr>
<tr>
<td style="text-align: left"><strong>userCode</strong></td>
<td style="text-align: left">String</td>
<td style="text-align: left"></td>
<td style="text-align: left">An identifier for the User, unique among all itsme® accounts and never reused. Use <code>userCode</code> in the application as the unique-identifier key for the User.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sigObj</strong></td>
<td style="text-align: left">Array</td>
<td style="text-align: left"></td>
<td style="text-align: left">This is the signature object. Currently this is the hash to be signed.</td>
</tr>
</tbody></table>
<h3 id='handling-error-response-2'>Handling Error Response</h3>
<p>See <a href="#RequestObjectByValue">Appendixes</a> to get more information on the error codes.</p>
<h1 id='4-appendixes'>4. Appendixes</h1><h2 id='4-1-handling-error-response'>4.1. Handling Error Response</h2>
<p>If one of the above request is invalid or unauthorized an error code will be returned to the User using the appropriate HTTPS status code, as listed in the table below:</p>

<table><thead>
<tr>
<th style="text-align: left">Status code</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>400</strong></td>
<td style="text-align: left">Returned in case of invalid Request Object.</td>
</tr>
<tr>
<td style="text-align: left"><strong>409</strong></td>
<td style="text-align: left">Returned in case the User identification flow has been interrupted.</td>
</tr>
<tr>
<td style="text-align: left"><strong>500</strong></td>
<td style="text-align: left">Internal Server Error.</td>
</tr>
</tbody></table>

<p>The Error Response will contain the <code>status</code> and the <code>statusReason</code> value. The following table describes the various error types that can be returned in the <code>statusReason</code> value of the error response:</p>

<table><thead>
<tr>
<th style="text-align: left">Status code</th>
<th style="text-align: left">Error</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>400</strong></td>
<td style="text-align: left">NO_REQUEST</td>
<td style="text-align: left">user_identification is a POST service. A body should be inserted into the request. For more information on the structure of this request, you can go to the section related to /user_identification.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">MISSING_PARTNER_CODE</td>
<td style="text-align: left">In this case, the body request does not contain the field &quot;partnerCode&quot;. This field corresponds to the &quot;Partner Code/Client ID&quot; referenced in your onboarding file.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">MISSING_SERVICE_CODE</td>
<td style="text-align: left">The body request does not contain the field &quot;serviceCode&quot;. This field corresponds to the &quot;Service Code&quot; referenced in your onboarding file.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">INVALID_URL</td>
<td style="text-align: left">The field &quot;redirectUrl&quot; is null or its syntax is not correct, URL is invalid. This field corresponds to the &quot;Redirect URL&quot; referenced in your onboarding file.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">INVALID_REQUESTOR</td>
<td style="text-align: left">The &quot;partnerCode&quot; and/or &quot;serviceCode&quot; referenced into the body do not reference an existing partner and/or service. The &quot;partnerCode&quot; corresponds to the &quot;Partner Code/Client ID&quot; referenced in your onboarding file. The &quot;serviceCode&quot; corresponds to the &quot;Service Code&quot; referenced in your onboarding file for a SIGN service.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">UNAUTHORIZED_URL</td>
<td style="text-align: left">The partner and its service have been correctly found by itsme® following referenced &quot;partnerCode&quot; and &quot;serviceCode&quot;, but the given &quot;redirectUrl&quot; is not authorized for the partner and/or service mentioned. You did not provide a valid redirectUrl. The &quot;redirectUrl&quot; used here corresponds to the &quot;Redirect URL&quot; referenced in your onboarding file.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">INVALID_LANG</td>
<td style="text-align: left">The &quot;lang&quot; field does not reference a language supported by itsme®. You can consult &quot;BMID Well-Known Configuration&quot; to check which are the languages supported by  itsme®, /well-known/configuration.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">UNEXPECTED_ERROR</td>
<td style="text-align: left">An error occurred during the validation of partner information. You should try again later. If the error persists, then you should contact itsme® support team for investigation.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">UNKNOWN</td>
<td style="text-align: left">An unknown error occurred during the request. You should contact itsme® support team for investigation.</td>
</tr>
<tr>
<td style="text-align: left"><strong>409</strong></td>
<td style="text-align: left">PENDING</td>
<td style="text-align: left">The User Identification Session you created is  pending. The User is currently following the User Identification flow at itsme® side (web and mobile).</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">REJECTED</td>
<td style="text-align: left">The User had to create a certificate in order to make a signature. However, he rejected his CREATE_CERT action in the itsme® App. A new User Identification session must be initialized. During that session, User has to confirm the CREATE_CERT action.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">EXPIRED</td>
<td style="text-align: left">The User had to create a certificate in order to make a signature. However, he waited too long (more than three minutes) before confirming his CREATE_CERT action in the itsme® App and his action expired. A new User Identification Session must be initialized. During that session, User has to confirm the CREATE_CERT action in time.</td>
</tr>
<tr>
<td style="text-align: left"><label></label></td>
<td style="text-align: left">UNEXPECTED_ERROR</td>
<td style="text-align: left">An unexpected error occurred during User’s Identification flow. You should try again later. If the error persists, then you should contact itsme® support team for investigation.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">HTTP</a>
          </div>
      </div>
    </div>
  </body>
</html>
