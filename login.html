
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>itsme® OpenID Connect documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="login" data-languages="[&quot;http&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="http">HTTP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#1-introduction" class="toc-h1 toc-link" data-title="1-introduction">1. Introduction</a>
          </li>
          <li>
            <a href="#2-prerequisites" class="toc-h1 toc-link" data-title="2-prerequisites">2. Prerequisites</a>
          </li>
          <li>
            <a href="#3-integrating-login-and-share-data-services" class="toc-h1 toc-link" data-title="3-integrating-login-and-share-data-services">3. Integrating Login and Share Data services</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#3-1-checking-itsme-openid-provider-configuration" class="toc-h2 toc-link" data-title="3-1-checking-itsme-openid-provider-configuration">3.1. Checking itsme® OpenID Provider configuration</a>
                  </li>
                  <li>
                    <a href="#3-2-forging-an-authentication-request" class="toc-h2 toc-link" data-title="3-2-forging-an-authentication-request">3.2. Forging an Authentication Request</a>
                  </li>
                  <li>
                    <a href="#3-3-capturing-an-authorization-code" class="toc-h2 toc-link" data-title="3-3-capturing-an-authorization-code">3.3. Capturing an Authorization Code</a>
                  </li>
                  <li>
                    <a href="#3-4-supporting-universal-links-and-app-links-mechanism" class="toc-h2 toc-link" data-title="3-4-supporting-universal-links-and-app-links-mechanism">3.4. Supporting Universal Links and App Links mechanism</a>
                  </li>
                  <li>
                    <a href="#3-5-exchanging-the-authorization-code" class="toc-h2 toc-link" data-title="3-5-exchanging-the-authorization-code">3.5. Exchanging the Authorization Code</a>
                  </li>
                  <li>
                    <a href="#3-6-managing-token-response" class="toc-h2 toc-link" data-title="3-6-managing-token-response">3.6. Managing Token Response</a>
                  </li>
                  <li>
                    <a href="#3-7-obtaining-user-attributes-or-claims" class="toc-h2 toc-link" data-title="3-7-obtaining-user-attributes-or-claims">3.7. Obtaining User attributes or claims</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#4-mapping-the-user" class="toc-h1 toc-link" data-title="4-mapping-the-user">4. Mapping the User</a>
          </li>
          <li>
            <a href="#5-appendixes" class="toc-h1 toc-link" data-title="5-appendixes">5. Appendixes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#5-1-universal-links-on-ios" class="toc-h2 toc-link" data-title="5-1-universal-links-on-ios">5.1. Universal Links on iOS</a>
                  </li>
                  <li>
                    <a href="#5-2-app-links-on-android" class="toc-h2 toc-link" data-title="5-2-app-links-on-android">5.2. App Links on Android</a>
                  </li>
                  <li>
                    <a href="#5-3-security-levels-and-context-data" class="toc-h2 toc-link" data-title="5-3-security-levels-and-context-data">5.3. Security levels and context data</a>
                  </li>
                  <li>
                    <a href="#5-4-using-the-request-parameter" class="toc-h2 toc-link" data-title="5-4-using-the-request-parameter">5.4. Using the request parameter</a>
                  </li>
                  <li>
                    <a href="#5-5-using-request_uri-parameter" class="toc-h2 toc-link" data-title="5-5-using-request_uri-parameter">5.5. Using request_uri parameter</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a> --></li>
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='1-introduction'>1. Introduction</h1>
<p>itsme® is a trusted identity provider allowing partners to use verified identities for authentication and authorization on web desktop, mobile web and mobile applications. </p>

<p>The objective of this document is to provide all the information needed to integrate the <strong>Login</strong> and <strong>Share Data</strong> services using the <a href="http://openid.net/specs/openid-connect-core-1_0.html" target="blank">OpenID Connect Core 1.0 specifications</a>.</p>

<p><a name="Onboarding"></a></p>
<h1 id='2-prerequisites'>2. Prerequisites</h1>
<p>Before you can integrate your application with itsme® Login and Share Data services, you MUST set up a project in the <a href="https://brand.belgianmobileid.be/d/CX5YsAKEmVI7" target="blank">itsme® B2B portal</a> to obtain all the needed information.</p>
<h1 id='3-integrating-login-and-share-data-services'>3. Integrating Login and Share Data services</h1>
<p>The itsme® Login and Share Data service integration is based on the <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth" target="blank">Authorization Code Flow</a> of OpenID Connect 1.0. The Authorization Code Flow goes through the steps as defined in <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowSteps" target="blank">OpenID Connect Core Authorization Code Flow Steps</a>, depicted in the following diagram:</p>

<p><img src="OpenID_Login_SeqDiag.png" alt="Sequence diagram describing the OpenID flow" /></p>

<ol>
  <li>The User indicates on your end he wishes to authenticate with itsme®</li>
  <li>Your web desktop, mobile web or mobile application (aka 'Relying Party' in the OpenID Connect specification) sends a request to itsme® (aka 'OpenID Provider' in the OpenID Connect specification) to authenticate the User. This request will redirect the user to the itsme® Front-End. itsme® then authenticates the User by asking him
    <ul type>
      <li>to enter his phone number on the itsme® OpenID web page</li>
      <li>authorize the release of some information’s to your application</li>
      <li>to provide his credentials (itsme® code or fingerprint or FaceID)</li>
    </ul>
  
  If you are building a mobile web or mobile application, the User don’t need to enter his MSISDN on the itsme® OpenID web page, he will be automatically redirected to the itsme app via the Universal links or App links mechanism.</li>
  <li>Once the User has authorized the request and has been authenticated, itsme® will return an Authorization Code to the Service Provider Front-End, redirecting the user to your mobile or web application.</li>
  <li>The Service Provider Back-End calls the itsme® Token Endpoint and exchanges the Authorization Code for an ID Token identifying the User and an Access Token.</li>
  <li>The Service Provider Back-End requests the additional user information from the itsme® userInfo Endpoint by presenting the Access Token obtained in the previous step.</li>
  <li>At this stage you are able to confirm the success of the operation and display a success message.</li>
</ol>

<p>This flow is described in much more detail in the following sections.</p>

<p><a name="OpenIDConfig"></a></p>
<h2 id='3-1-checking-itsme-openid-provider-configuration'>3.1. Checking itsme® OpenID Provider configuration</h2>
<p>To simplify implementations and increase flexibility, <a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="blank">OpenID Connect allows the use of a Discovery Document</a>, a JSON document containing key-value pairs which provide details about itsme® configuration, such as the URIs of the </p>

<ul>
  <li>Authorization, Token and userInfo Endpoints</li>
  <li>supported claims</li>
  <li>JWKSet URL</li>
  <li>...</li>
</ul>

<p>The Discovery document for itsme® services may be retrieved from: </p>

<table><thead>
<tr>
<th style="text-align: left">Environment</th>
<th style="text-align: left">URL</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>SANDBOX</strong></td>
<td style="text-align: left"><a href="https://e2emerchant.itsme.be/oidc/.well-known/openid-configuration" target="blank">https://e2emerchant.itsme.be/oidc/.well-known/openid-configuration</a></td>
</tr>
<tr>
<td style="text-align: left"><strong>PRODUCTION</strong></td>
<td style="text-align: left"><a href="https://merchant.itsme.be/oidc/.well-known/openid-configuration" target="blank">https://merchant.itsme.be/oidc/.well-known/openid-configuration</a></td>
</tr>
</tbody></table>

<p><a name="AuthNRequest"></a></p>
<h2 id='3-2-forging-an-authentication-request'>3.2. Forging an Authentication Request</h2>
<p>First, you will forg a HTTPS GET request that MUST be sent to the itsme® Authorization Endpoint. The itsme® Authorization Endpoint can be retrieved from the <a href="#OpenIDConfig">itsme® Discovery document</a>, using the key <code>authorization_endpoint</code>.</p>

<aside class="alert">By opposition to the OpenID Connect specifications, POST method is not authorized when triggering the itsme® App through the Universal/App Link mechanism only support the HTTP GET method on the Authorisation Endpoint. More information about Universal links and App links can be found in the <a href="#UniversalLinks">section 3.4</a>.
</aside>

<p>The OpenID Connect Core specification defines a number of mandatory and recommended parameters to integrate in the HTTPS GET query string:</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">GET</span> <span class="nn">/authorization?response_type=code</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">&amp;scope=openid%20profile%20email%20service%3Aclient.registration</span>
<span class="s">&amp;client_id=s6BhdRkqt3</span>
<span class="s">&amp;state=af0ifjsldkj</span>
<span class="s">&amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb HTTP/1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">server.itsme.be</span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>client_id</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the client ID you received when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>response_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This defines the processing flow to be used when forming the response. Because itsme® uses the Authorization Code Flow as described above, this value MUST be <code>code</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>scope</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The scope parameter allows the application to express the desired scope of the access request. It MUST contain the value <code>openid</code> and <code>service:service_code</code>, the itsme® service you want to use as defined for your project in the <a href="#Onboarding">itsme® B2B portal</a>.<br>You can also specify additional scopes, separated by spaces, to request more information about the User. The following additional scopes apply:<ul><li>profile: will request the claims representing basic profile information. These are <code>family_name</code>, <code>given_name</code>, <code>gender</code>, <code>birthdate</code> and <code>locale</code>.</li><li>email: will request the <code>email</code> and <code>email_verified</code> claims.</li><li>phone: will request the <code>phone_number</code> and <code>phone_number_verified</code> claims.</li><li>address: will request the <code>street_address</code>, <code>locality</code>, <code>postal_code</code> and <code>country</code> claims.</li></ul>For more information on User attributes or claims, please consult the <a href="#Data">ID claims</a> section.</br><br>An HTTP ERROR <code>not_implemented</code> will be returned if the required values are not specified.</br><br>Unrecognised values will be ignored.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the URI to which the authentication response should be sent. This MUST exactly match the redirect URI of the specified service defined when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>state</strong></td>
<td style="text-align: left">Strongly RECOMMENDED</td>
<td style="text-align: left">An opaque value used in the Authentication Request, which will be returned unchanged in the Authorization Code. This parameter SHOULD be used for preventing cross-site request forgery (XRSF). <br>When deciding how to implement this, one suggestion is to use a private key together with some easily verifiable variables, for example, your client ID and a session cookie, to compute a hashed value. This will result in a byte value that will be infeasibility difficult to guess without the private key. After computing such an HMAC, base-64 encode it and pass it to the Authorization  Server as <code>state</code> parameter. Another suggestion is to hash the current date and time. This requires your application to save the time of transmission in order to verify it or to allow a sliding period of validity.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>nonce</strong></td>
<td style="text-align: left">Strongly RECOMMENDED</td>
<td style="text-align: left">A string value used to associate a session with an ID Token, and to mitigate replay attacks. The value is passed through unmodified from the Authentication Request to the ID Token. Sufficient entropy MUST be present in the <code>nonce</code> values used to prevent attackers from guessing values. See <a href="http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes" target="blank">OpenID Connect Core specifications</a> for more information.</td>
</tr>
<tr>
<td style="text-align: left"><strong>login_hint</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Hint to the Authorization Server about the login identifier the User might use to log in (if necessary).<br>If provided, this value MUST be a phone number in the format specified for the <code>phone_number</code> claim: <code>&lt;countrycode&gt;+&lt;phonenumber&gt;</code>. E.g. <code>login_hint=32+123456789</code>.</br><br><code>login_hint</code> with invalid syntax will be ignored.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>display</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">ASCII string value that specifies how the Authorization Server displays the authentication and consent User interface pages to the User. MUST be <code>page</code> if provided.<br>Other values will yield an HTTP ERROR <code>not_implemented</code>.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>prompt</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Space delimited, case sensitive list of ASCII string values that specifies whether the Authorization Server prompts the User for reauthentication and consent. MUST be <code>consent</code> if provided.</td>
</tr>
<tr>
<td style="text-align: left"><strong>ui_locales</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">User&#39;s preferred languages and scripts for the User interface (e.g.: OpenID web page). Supported values are: <code>fr</code>, <code>nl</code>, <code>en</code> and <code>de</code>. Any other value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>max_age</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.<br>As itsme® does not maintain a session mechanism, an active authentication is always required.</br></td>
</tr>
<tr>
<td style="text-align: left"><a name="acrvalues"><strong>acr_values</strong></a></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Space-separated string that specifies the acr values that the Authorization Server is being requested to use for processing this Authentication Request, with the values appearing in order of preference.<br>2 values are supported:<ul><li>Basic level - let the User to choose either fingerprint usage (if device is compatible) or PIN<br><code>tag:sixdots.be,2016-06:acr_basic</code></br></li><li>Advanced level - force the User to use PIN<br><code>tag:sixdots.be,2016-06:acr_advanced</code></br></li></ul>When multiple values are provided only the most constraining will be used (advanced &gt; basic). If not provided basic level will be used.</br><br>More information on security levels and context data can be found in the <a href="#SecurityLevels">Appendixes</a>.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>claims</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter is used to request that specific claims be returned. The value is a JSON object listing the requested claims. When passed as a HTTP GET parameter, the <code>claims</code> parameter value is represented as UTF-8 encoded JSON which ends up being form-urlencoded. When used in a Request Object value, see <a href="#RequestObjectByValue">Appendixes</a>, the JSON is used as the value of the claims member.<br>See <a href="#Data">User Data</a> for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>request</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter enables OpenID Connect requests to be passed in a single, self-contained parameter, and to be optionally signed with your private key and/or encrypted with the itsme® public key. The parameter value is a Request Object value. It represents the request as a JWT.<br>See <a href="#RequestObjectByValuei">Using request parameter</a> section for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>request_uri</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter MUST be used when the GET request lenght is too long. This parameter enables OpenID Connect requests to be passed by reference, rather than by value. The <code>request_uri</code> value is a URL using the https scheme referencing a resource containing a Request Object value, which is a JWT containing the request parameters. The URL MUST be shared with us when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.<br>See <a href="#RequestUri">Using request_uri parameter</a> for more details.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>response_mode</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>id_token_hint</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>claims_locales</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>registration</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
</tbody></table>

<p><a name="AuthNResponse"></a></p>
<h2 id='3-3-capturing-an-authorization-code'>3.3. Capturing an Authorization Code</h2><h3 id='capturing-a-successful-authorization-code'>Capturing a successful Authorization Code</h3>
<p>If the User is successfully authenticated and authorizes access to the data requested, itsme® will return an Authorization Code to your server component. This is achieved by returning an Authentication Response, which is a HTTP 302 redirect request to the <code>redirect_uri</code> specified previously in the Authentication Request.</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://client.example.org/cb?</span>
<span class="s">code=SplxlOBeZQQYbYS6WxSbIA&amp;</span>
<span class="s">state=af0ifjsldkj</span>
</code></pre>
<p>The response will contain:</p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>code</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The <code>code</code> parameter holds the Authorization Code which is a string value. The content of Authorization Code is opaque for you. This code has a lifetime of 3 minutes.</td>
</tr>
<tr>
<td style="text-align: left"><strong>state</strong></td>
<td style="text-align: left">If provided</td>
<td style="text-align: left">The <code>state</code> parameter will be returned if you provided a value in the Authentication Request. You should validate that the value returned matches the one supplied in the Authentication Request. The state value can additionally be used to mitigate against XSRF attacks by cryptographically binding the value of this parameter with a browser cookie.<br>If a wrong/unknown <code>state</code> is received, you should take it into account and refuse the related <code>code</code> or from a security detection/prevention point of view, monitor if it is a recurring pattern or not.</br></td>
</tr>
</tbody></table>
<h3 id='handling-authentication-error-response'>Handling Authentication Error Response</h3>
<p>If the request fails due to a missing, invalid, or mismatching redirection URI, or if the client identifier is missing or invalid, the Authorization Server SHOULD inform the User of the error and MUST NOT automatically redirect him to the invalid redirection URI. </p>

<p>If the User denies the Authentication Request or if the request fails for reasons other than a missing or invalid redirection URI, itsme® will return an error response to your application. As for a successful response this is achieved by returning a HTTPS 302 redirect request to the redirection_uri specified in the Authentication Request. Following parameters could be added to the query component of the redirection_uri:</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://client.example.org/cb?</span>
<span class="s">error=invalid_request</span>
<span class="s">&amp;error_description=Unsupported%20response_type%20value</span>
<span class="s">&amp;state=af0ifjsldkj </span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>error</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Error type.</td>
</tr>
<tr>
<td style="text-align: left"><strong>error_description</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Indicating the nature of the error</td>
</tr>
</tbody></table>

<p>The following table describes the various error codes that can be returned in the <code>error</code> parameter of the error response:</p>

<table><thead>
<tr>
<th style="text-align: left">Error</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>interaction_required</strong></td>
<td style="text-align: left">The Authorization Server requires User interaction of some form to proceed.</td>
</tr>
<tr>
<td style="text-align: left"><strong>invalid_request_object</strong></td>
<td style="text-align: left">The <code>request</code> parameter contains an invalid Request Object.</td>
</tr>
<tr>
<td style="text-align: left"><strong>request_uri_not_supported</strong></td>
<td style="text-align: left">This error is returned because itsme® does not support use of the <code>request_uri</code> parameter defined in the JWTs.</td>
</tr>
<tr>
<td style="text-align: left"><strong>registration_not_supported</strong></td>
<td style="text-align: left">This error is returned because itsme® does not support use of the <code>registration</code> parameter.</td>
</tr>
</tbody></table>

<p>All other HTTPS errors unrelated to OpenID Connect Core will be returned to the User using the appropriate HTTPS status code.</p>

<p><a name="UniversalLinks"></a> </p>
<h2 id='3-4-supporting-universal-links-and-app-links-mechanism'>3.4. Supporting Universal Links and App Links mechanism</h2>
<p>Regardless of the application you are building you should make sure that your redirect URIs support the <a href="https://developer.apple.com/ios/universal-links/" target="blank">Universal links</a> and <a href="https://developer.android.com/studio/write/app-link-indexing" target="blank">App links</a> mechanism. Functionally, it will allow you to have only one single link that will either open your desktop web application, your mobile app or your mobile site on the User’s device.</p>

<p>Universal links and App links are standard web links (http://mydomain.com) that point to both a web page and a piece of content inside an app. When a Universal Link is opened, the app OS checks to see if any installed app is registered for that domain. If so, the app is launched immediately without ever loading the web page. If not, the web URL is loaded into the webbrowser.</p>

<p>An App link is the Android version of the Universal link.</p>

<p>How do Universal Links work in iOS and Android ? Before Universal Links, the primary mechanism to open up an app when it was installed was by trying to redirect to an app’s URI scheme  in the web browser. But there was no way to check if the app was installed or not. This meant that developers would try to call the URI scheme 100% of the time, in the off chance that the app was installed, then fallback gracefully to the App Store or Google Play Store when not by using a timer.</p>

<p>iOS Universal Links and Android App Links were intended to fix this. Instead of opening up the web browser first when a link is clicked, the OS will check if a Universal Link has been registered (a file should be there in the domain which contains the bundle id of the app and the paths the app should open) for the domain associated with the link, then check if the corresponding app is installed. If the app is currently installed, it will be opened. If it’s not, the web browser will open and the HTTPS link will load.</p>

<p>The specifications for the implementation of Universal links and App links can be found in the <a href="#Appendixes">Appendix</a>.</p>
<h2 id='3-5-exchanging-the-authorization-code'>3.5. Exchanging the Authorization Code</h2>
<p><a name="tokenEndpoint"></a> </p>

<p>Once your server component has received an <a href="#AuthNResponse">Authorization Code</a>, your server can exchange it for an Access Token and an ID Token.</p>

<aside class="notice">You might also read in the OpenID Connect Core specification about the Refresh Token, but we don't support them (we don't implement any session mechanism).</aside>

<p>Your server makes this exchange by sending an HTTPS POST request to the itsme® Token Endpoint URI. This URI can be retrieved from the <a href="#OpenIDConfig">itsme® Discovery document</a>, using the key <code>token_endpoint</code>.</p>

<aside class="notice">An Authorization Code can only be exchanged once. Attempting to re-exchange a code will generate a bad request response, outlined below in the section Handling token error response.</aside>

<p>The request MUST include the following parameters in the <code>POST</code> body:</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">POST</span> <span class="nn">/token</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">server.example.com</span>
<span class="na">Authorization</span><span class="p">:</span> <span class="s">Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>

grant_type=authorization_code&amp;code=SplxlOBeZQQYbYS6WxSbIA
&amp;redirect_uri=https%3A%2F%2Fclient%2Eexample%2Ecom%2Fcb
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>grant_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be set to <code>authorization_code</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>code</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The Authorization Code received in response to the Authentication Request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The redirection URI supplied in the original Authentication Request. This is the URL to which you want the User to be redirected after the authorization is complete.</td>
</tr>
<tr>
<td style="text-align: left"><strong>client_assertion</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">To ensure that the request is genuine and that the tokens are not returned to a third party, you will be authenticated when making the Token request.<br>The OpenID Connect Core specifications support multiple authentication methods, but itsme® only supports <code>private_key_jwt</code>. This authentication method uses a JWT signed using the private key corresponding to the public key you have registered when setting up your project in the <a href="#Onboarding">itsme® B2B portal</a>. The JWT MUST be sent as the value of the <code>client_assertion</code> parameter.</br><br>See the <a href="https://belgianmobileid.github.io/slate/jose.html" target="blank">JOSE</a> specifications for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>client_assertion_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be set to <code>urn:ietf:params:oauth:client-assertion-type:jwt-bearer</code>.</td>
</tr>
</tbody></table>

<p>According to the <code>private_key_jwt</code> client authentication method, the <code>client_assertion</code> JWT MUST contain the following parameters in the JWT Payload:</p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>iss</strong></td>
<td style="text-align: left">The issuer of the <code>private_key_jwt</code>. This MUST contain the <code>client_id</code>. This is the client identifier (e.g. : Project ID) you received when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sub</strong></td>
<td style="text-align: left">The subject of the <code>private_key_jwt</code>. This MUST contain the <code>client_id</code>. This is the client identifier (e.g. : Project ID) you received when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>aud</strong></td>
<td style="text-align: left">Value that identifies the Authorization Server as an intended audience. This MUST be the itsme® Token Endpoint URL : <code>https://merchant.itsme.be/oidc/token</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>jti</strong></td>
<td style="text-align: left">The <code>jti</code> (JWT ID) claim provides a unique identifier for the JWT. The identifier value MUST be assigned by the you in a manner that ensures that there is a negligible probability that the same value will be accidentally assigned to a different data object; if the application uses multiple issuers, collisions MUST be prevented among values produced by different issuers as well.  The <code>jti</code> claim can be used  to prevent the JWT from being replayed. The <code>jti</code> value is a case-sensitive string.</td>
</tr>
<tr>
<td style="text-align: left"><strong>exp</strong></td>
<td style="text-align: left">The <code>exp</code> (expiration time) claim identifies the expiration time on or after which the JWT MUST NOT be accepted for processing.  The processing of the <code>exp</code> claim requires that the current date/time MUST be before the expiration date/time listed in the <code>exp</code> claim. Implementers MAY provide for some small leeway, usually no more than a few minutes, to account for clock skew.  Its value MUST be a number containing a NumericDate value (e.g. 1538507868 for Tuesday, March 22, 2011 6:43:00 PM).</td>
</tr>
</tbody></table>

<p><a name="TokenResponse"></a></p>
<h2 id='3-6-managing-token-response'>3.6. Managing Token Response</h2><h3 id='extracting-a-successful-token-response'>Extracting a successful Token response</h3>
<p>If the Token request has been sucessfully validated we will return an HTTP 200 OK response including ID and Access Tokens as in the example aside.</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="s">{</span>
<span class="s">  "access_token": "SlAV32hkKG",</span>
<span class="s">  "token_type": "Bearer",</span>
<span class="s">  "expires_in": 3600,</span>
<span class="s">  "id_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjFlOWdkazcifQ.ewogImlzc</span>
<span class="s">  yI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4Mjg5</span>
<span class="s">  NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAibi0wUzZ</span>
<span class="s">  fV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEzMTEyODA5Nz</span>
<span class="s">  AKfQ.ggW8hZ1EuVLuxNuuIJKX_V8a_OMXzR0EHR9R6jgdqrOOF4daGU96Sr_P6q</span>
<span class="s">  Jp6IcmD3HP99Obi1PRs-cwh3LO-p146waJ8IhehcwL7F09JdijmBqkvPeB2T9CJ</span>
<span class="s">  NqeGpe-gccMg4vfKjkM8FcGvnzZUN4_KSP0aAp1tOJ1zZwgjxqGByKHiOtX7Tpd</span>
<span class="s">  QyHE5lcMiKPXfEIQILVq0pc_E2DzL7emopWoaoZTF_m0_N0YzFC6g6EJbOEoRoS</span>
<span class="s">  K5hoDalrcvRYLSrQAZZKflyuVCyixEoV9GfNQC3_osjzw2PAithfubEEBLuVVk4</span>
<span class="s">  XUVrWOLrLl0nx7RkKU8NXNHq-rvKMzqg"</span>
<span class="s">}</span>
</code></pre>
<p>The response body will include the following values:</p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>access_token</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The Access Token which may be used to access the userInfo Endpoint.</td>
</tr>
<tr>
<td style="text-align: left"><strong>token_type</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Set to <code>Bearer</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>id_token</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The Base64URL encoded token encrypted with your public key and signed with the itsme® private key.</td>
</tr>
<tr>
<td style="text-align: left"><strong>at_hash</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">itsme® does not provide any value for this parameter.</td>
</tr>
<tr>
<td style="text-align: left"><strong>refresh_token</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">itsme® does not provide any value for this parameter as it only maintains short-lived session to enforce re-authentication.</td>
</tr>
</tbody></table>

<p>The <code>id_token</code> parameter is comprised of three Base64URL encoded elements. The first element is the ID Token header. If you decode the value you should get a string similar to the one below:</p>

<p><code>{&quot;alg&quot;:&quot;RS256&quot;,&quot;kid&quot;:&quot;1e9gdk7&quot;}</code></p>

<p>This specifies that the token has been signed with an RSA Signature utilising the SHA-256 hashing algorithm and the key identified by the string “1e9gdk7”. </p>

<p>Decoding the second element gives you the JSON object containing the claims about the User. Following fields could be returned: For example decoding the value from the example above gives:</p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>iss</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Identifier of the issuer of the ID Token.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sub</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">An for the User, unique among all itsme® accounts and never reused. Use <code>sub</code> in the application as the unique-identifier key for the User. It has 32 characters.</td>
</tr>
<tr>
<td style="text-align: left"><strong>aud</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Audience of the ID Token. This will contain the <code>client_id</code>. This is the client identifier (e.g. : Project ID) you received when registering your project in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>exp</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Expiration time on or after which the ID Token MUST NOT be accepted for processing.</td>
</tr>
<tr>
<td style="text-align: left"><strong>iat</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The time the ID Token was issued, represented in Unix time (integer seconds).</td>
</tr>
<tr>
<td style="text-align: left"><strong>auth_time</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The time the User authentication occurred, represented in Unix time (integer seconds).</td>
</tr>
<tr>
<td style="text-align: left"><strong>nonce</strong></td>
<td style="text-align: left">If provided</td>
<td style="text-align: left">String value used to associate a session with an ID Token, and to mitigate replay attacks. The value is passed through unmodified from the Authentication Request to the ID Token. Sufficient entropy MUST be present in the <code>nonce</code> values used to prevent attackers from guessing values. See <a href="http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes" target="blank">the OpenID Connect Core specifications</a> for more information.</td>
</tr>
<tr>
<td style="text-align: left"><strong>acr</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Possible values: <code>tag:sixdots.be,2016-06:acr_basic</code> and <code>tag:sixdots.be,2016-06:acr_advanced</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>amr</strong></td>
<td style="text-align: left">Never</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>azp</strong></td>
<td style="text-align: left">Never</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>

<p>The third element is the signature over the JSON object. Details on how this signature is created and on how to validate it can be found in the <a href="https://tools.ietf.org/html/rfc7515" target="blank">JSON Web Signature specification</a>.</p>

<p>In short, this Base64URL encoding is called a JSON Web Token (JWT). It makes sure that the data you received has not been modified. </p>
<h3 id='handling-token-error-response'>Handling token error response</h3>
<p>If the Token Request is invalid or unauthorized an HTTP 400 response will be returned as in the example:</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>
<span class="s">{</span>
<span class="s">  "error": "invalid_request"</span>
<span class="s">}</span>
</code></pre>
<p>The response will contain an error parameter and optionally <code>error_description</code> and <code>error_uri</code> parameters. The <code>error_uri</code> parameter may be used by implementations to specify a human-readable web page with information about the error, used to provide the client developer with additional information about the error.</p>

<p><a name="Data"></a></p>
<h2 id='3-7-obtaining-user-attributes-or-claims'>3.7. Obtaining User attributes or claims</h2>
<p>OpenID Connect Core specifications also allow your application to obtain basic profile information about a specific User in a interoperable way. These User attributes or claims can be obtained by presenting the <code>access_token</code> to the itsme® userInfo Endpoint, which can be retrieved from the <a href="#OpenIDConfig">itsme® Discovery document</a>, using the key <code>userinfo_endpoint</code>. This is achieved by sending a HTTPS GET request over TLS to the userInfo Endpoint URI, passing the Access Token value in the Authorization header using the Bearer authentication scheme.</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="s">  Content-Type: application/json</span>

  {
   "sub": "248289761001",
   "name": "Jane Doe",
   "given_name": "Jane",
   "family_name": "Doe",
   "email": "janedoe@example.com"
  }  
</code></pre>
<p>The itsme® userInfo Endpoint will return specific claims in a HTTP 200 OK response, depending on the values you requested in the <code>scope</code> and/or <code>claims</code> parameter.</p>

<aside class="notice">The `sub` claim will always be included in the response and this should be verified by you to mitigate against token substitution attacks. The `sub` claim in the userInfo response MUST be verified to exactly match the `sub` Claim in the <code>id_token</code>; if they do not match, the userInfo response values MUST NOT be used.</aside>

<aside class="notice">For privacy reasons itsme® may elect to not return values for some requested claims. In that case the claim will be omitted from the JSON object rather than being present with a null or empty string value.</aside>

<aside class="notice">itsme® will ensure that the userInfo response is signed and encrypted, meaning that the content type will be set to application/jwt. The userInfo response will contain the `iss` and `aud` claims. You should validate that the `iss` value matches itsme® issuer identifier and the `aud` value contains the your `client_id`.</aside>

<aside class="notice">You should authenticate the OpenID Provider either by checking the TLS certificate or by validating the signature of the JWT if provided.</aside>

<p>When an error condition occurs an error response as defined in the <a href="https://tools.ietf.org/html/rfc6750" target="blank">OAuth 2.0 Bearer Token Usage specification</a> will be returned.</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">401</span> <span class="ne">Unauthorized</span>
<span class="s">  WWW-Authenticate: error="invalid_token",</span>
<span class="s">    error_description="The Access Token expired"</span>
</code></pre><h3 id='capturing-claims-from-the-39-scope-39-parameter'>Capturing claims from the &#39;scope&#39; parameter</h3>
<p>On top of the <code>openid</code> and <code>service:service_code</code> parameters specified in the Authentication Request, you can also ask for additional scopes, separated by spaces, to request more information about the User. The following additional scopes apply:</p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>profile</strong></td>
<td style="text-align: left">It will request the claims representing basic profile information. These are <code>family_name</code>, <code>given_name</code>, <code>gender</code>, <code>birthdate</code> and <code>locale</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>email</strong></td>
<td style="text-align: left">It will request the <code>email</code> and <code>email_verified</code> claims.</td>
</tr>
<tr>
<td style="text-align: left"><strong>phone</strong></td>
<td style="text-align: left">It will request the <code>phone_number</code> and <code>phone_number_verified</code> claims</td>
</tr>
<tr>
<td style="text-align: left"><strong>address</strong></td>
<td style="text-align: left">It will request the <code>street_address</code>, <code>locality</code>, <code>postal_code</code> and <code>country</code> claims.</td>
</tr>
</tbody></table>

<p>The values returned via the itsme® userInfo Endpoint are those below:</p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>family_name</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>given_name</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>gender</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>birthdate</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>locale</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left">The language of the User</td>
</tr>
<tr>
<td style="text-align: left"><strong>email</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left">The User&#39;s email address. This may not be unique and is not suitable for use as a primary key. Provided only if your scope included the string &quot;email&quot;.</td>
</tr>
<tr>
<td style="text-align: left"><strong>email_verified</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"><code>true</code> if the User&#39;s e-mail address has been verified; otherwise <code>false</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>phone_number</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>phone_number_verified</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>street_address</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>locality</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>postal_code</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>country</strong></td>
<td style="text-align: left">If requested</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='capturing-claims-from-the-39-claims-39-parameter'>Capturing claims from the &#39;claims&#39; parameter</h3>
<p>Typically, the values returned via the <code>scope</code> parameter only contain claims about the identity of the User. More information about the User can be requested by including additional parameters in the <code>claims</code> parameter as specified below:</p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2016-06:claim_nationality</strong></td>
<td style="text-align: left">It will request the <code>nationality</code> claim.</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2016-06:claim_city_of_birth</strong></td>
<td style="text-align: left">It will request the <code>place of Birth - city</code> claim.</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2016-06:claim_eid</strong></td>
<td style="text-align: left">It will request the  <code>eid</code>, <code>issuance_locality</code>, <code>validity_from</code>, <code>validity_to</code>, <code>certificate_validity</code> and <code>read_date</code> claims</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2017-05:claim_passport_sn</strong></td>
<td style="text-align: left">It will request the <code>passport Number</code> claim.</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2017-05:claim_device</strong></td>
<td style="text-align: left">It will request the <code>os</code>, <code>appName</code>, <code>appRelease</code>, <code>deviceLabel</code>, <code>debugEnabled</code>, <code>deviceID</code>, <code>osRelease</code>, <code>manufacturer</code>, <code>hasSimEnabled</code>, <code>deviceLockLevel</code>, <code>smsEnabled</code>, <code>rooted</code>, <code>imei</code>, <code>deviceModel</code>, <code>msisdn</code> and <code>sdkRelease</code> claims.</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2017-05:claim_transaction_info</strong></td>
<td style="text-align: left">It will request the <code>securityLevel</code>, <code>bindLevel</code> and <code>mcc</code> claims.</td>
</tr>
<tr>
<td style="text-align: left"><strong>tag:sixdots.be,2017-05:2017-05:claim_photo</strong></td>
<td style="text-align: left">It will request the <code>e-ID Picture</code> claim.</td>
</tr>
</tbody></table>

<p>The values returned via the itsme® userInfo Endpoint are those below:</p>

<p><a name id="SecurityDataElements"></a></p>

<table><thead>
<tr>
<th style="text-align: left">Values</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>nationality</strong></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>place of Birth - city</strong></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>eid</strong></td>
<td style="text-align: left">The eID card serial number.</td>
</tr>
<tr>
<td style="text-align: left"><strong>issuance_locality</strong></td>
<td style="text-align: left">The eID card issuance locality.</td>
</tr>
<tr>
<td style="text-align: left"><strong>validity_from</strong></td>
<td style="text-align: left">The eID card validity “from” date.</td>
</tr>
<tr>
<td style="text-align: left"><strong>validity_to</strong></td>
<td style="text-align: left">The eID card validity “to” date.</td>
</tr>
<tr>
<td style="text-align: left"><strong>certificate_validity</strong></td>
<td style="text-align: left">The eID card certificate validity.</td>
</tr>
<tr>
<td style="text-align: left"><strong>read_date</strong></td>
<td style="text-align: left">The data extraction date. The date is encoded using ISO 8601 UTC (timezone) date format (example: 2017-04-01T19:43:37+0000).</td>
</tr>
<tr>
<td style="text-align: left"><strong>passport Number</strong></td>
<td style="text-align: left">Simple string containing the User’s Passport Serial Number.</td>
</tr>
<tr>
<td style="text-align: left"><strong>os</strong></td>
<td style="text-align: left">The device operating system. The returned values will be <code>ANDROID</code>or <code>iOS</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>appName</strong></td>
<td style="text-align: left">The application name.</td>
</tr>
<tr>
<td style="text-align: left"><strong>appRelease</strong></td>
<td style="text-align: left">The application current release.</td>
</tr>
<tr>
<td style="text-align: left"><strong>deviceLabel</strong></td>
<td style="text-align: left">The name of the device.</td>
</tr>
<tr>
<td style="text-align: left"><strong>debugEnabled</strong></td>
<td style="text-align: left"><code>True</code> if debug mode has been activated; otherwise <code>false</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>deviceId</strong></td>
<td style="text-align: left">The device identifier.</td>
</tr>
<tr>
<td style="text-align: left"><strong>osRelease</strong></td>
<td style="text-align: left">The version of the OS running on your device.</td>
</tr>
<tr>
<td style="text-align: left"><strong>manufacturer</strong></td>
<td style="text-align: left">The brand of the device manufacturer.</td>
</tr>
<tr>
<td style="text-align: left"><strong>hasSimEnabled</strong></td>
<td style="text-align: left">It tells you if a SIM card is installed in the device, or not. The returned value is always <code>true</code> as long as itsme® can&#39;t be installed on tablets.</td>
</tr>
<tr>
<td style="text-align: left"><strong>deviceLockLevel</strong></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>smsEnabled</strong></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>rooted</strong></td>
<td style="text-align: left">The returned value is always <code>false</code> as long as itsme® can&#39;t be used on a jailbreaked/rooted device.</td>
</tr>
<tr>
<td style="text-align: left"><strong>imei</strong></td>
<td style="text-align: left">The device IMEI value.</td>
</tr>
<tr>
<td style="text-align: left"><strong>deviceModel</strong></td>
<td style="text-align: left">The model of the device.</td>
</tr>
<tr>
<td style="text-align: left"><strong>msisdn</strong></td>
<td style="text-align: left">The User’s phone number.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sdkRelease</strong></td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>securityLevel</strong></td>
<td style="text-align: left">The security level used during transaction. The returned values could be <code>SOFT_ONLY</code>, <code>SIM_ONLY</code> or <code>SIM_AND_SOFT</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>bindLevel</strong></td>
<td style="text-align: left">It tells you if the User account is bound to a SIM card or not, at the time the transaction occurred. The returned values could be <code>SOFT_ONLY</code>, <code>SIM_ONLY</code> or <code>SIM_AND_SOFT</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>mcc</strong></td>
<td style="text-align: left">The Mobile Country Code. The returned value is an Integer (three digits) representing the mobile network country.</td>
</tr>
<tr>
<td style="text-align: left"><strong>e-ID Picture</strong></td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h1 id='4-mapping-the-user'>4. Mapping the User</h1>
<p>To sign in successfully in your web desktop, mobile web or mobile application, a given user must be provisioned in OpenID Connect and then mapped to a user account in your database. By default, your application Server will use the subject identifier, or <code>sub</code> claim, in the ID Token to identify and verify a user account. Typically, the <code>sub</code> claim is a unique string that identifies a given user account. The benefit of using a <code>sub</code> claim is that it will not change, even if other user attributes (email, phone number, etc) associated with that account are updated. </p>

<p>The <code>sub</code> claim value must be mapped to the corresponding user in your application Server. If you already mapped this <code>sub</code> to an account in your application repository, you should start an application session for that User.</p>

<p>If no user record is storing the <code>sub</code> claim value, then you should allow the User to associate his new or existing account during the first sign-in session.</p>

<p>All these flows are depicted in the <a href="https://brand.belgianmobileid.be/document/39#/ux/ux-flows" target="blank">itsme® B2B portal</a>.</p>

<p>In a limited number of cases (e.g. change phone number, technical issue,…) a user could ask itsme® to ‘delete’ his account. As a result the specific account will be ‘archived’ (for compliancy reasons) and thus also the unique identifier(s) (e.g. <code>sub</code>), used to interact with the different Service Providers the specific users is active with, will be automatically deleted in our database.</p>

<p>If the same user would opt to (re)create an itsme® afterwards, he will need to re-bind his itsme® account with your application server (as the initial identifier is no longer valid as explained before). To re-bind his itsme® account one of the above scenario should be used. After successful (re)binding you will need to overwrite the initial reference with the new ‘sub’ claim value in your database.</p>
<h1 id='5-appendixes'>5. Appendixes</h1>
<p><a name="Appendix"></a> </p>
<h2 id='5-1-universal-links-on-ios'>5.1. Universal Links on iOS</h2><pre class="highlight plaintext"><code>{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": “JHGFJHHYX.com.facebook.ios",
        "paths": [
          "*"
        ]
      }
    ]
  }
} 
</code></pre>
<p>Integration is going to be pretty straightforward, all details can be found in below steps (as documented on <a href="https://developer.apple.com/ios/universal-links/" target="blank">Universal Links official documentation</a>):</p>

<ol>
  <li>Register your app at developer.apple.com.</li>
  <li>Enable ‘Associated Domains’ on your app identifier.</li>
  <li>Enable ‘Associated Domain’ on in your Xcode project.</li>
  <li>Add the proper domain entitlement and make sure the entitlements file is included at build: Xcode will do it automatically by itself.</li>
  <li>Create the ‘apple-app-site-association’ file (AASA). The AASA file contains a JSON object with a list of apps and the URL paths on the domain that should be included or excluded as Universal Links.<br>The JSON object will contain:</br></li>
</ol>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">appID</td>
<td style="text-align: left">Built by combining your app’s Team ID (it should be retrieved from https://developer.apple.com/account/#/membership/) and the Bundle Identifier. In the example attached, JHGFJHHYX is the Team ID and com.facebook.ios is the Bundle ID.</td>
</tr>
<tr>
<td style="text-align: left">paths</td>
<td style="text-align: left">Array of strings that specify which paths are included or excluded from association. Note: these strings are case sensitive and that query strings and fragment identifiers are ignored.</td>
</tr>
</tbody></table>

<ol>  
  <li value="6">Upload the ‘apple-app-site-association’ file to your HTTPS web server for the redirection URI communicated in the Authentication Request. The file can be placed at the root of your server or in the .well-known subdirectory.</li>
</ol>

<aside class="notice">While hosting the AASA file, please ensure that the AASA file:
    <ul>
      <li>is served over HTTPS.</li>
      <li>uses application/json MIME type.</li>
      <li>don’t append .json to the apple-app-site-association filename.</li>
      <li>has a size not exceeding 128 Kb (requirement in iOS 9.3.1 onwards)</li>
    </ul>  
</aside>

<ol>
  <li value="7">Check if the AASA file is valid and is accessible by using the <a href="https://branch.io/resources/aasa-validator/#resultsbox" target="blank">following link</a>.</li>
  <li>Add an entitlement to all redirect URI that the your app need to supports. In Xcode, open the Associated Domains section in the Capabilities tab and add an entry for each Redirect URI that your app supports, prefixed with `applinks`.<br>To match all subdomains of an associated redirect URI, you can specify a wildcard by prefixing `*.` before the beginning of a specific Redirect URI (the period is required). Redirect URI matching is based on the longest substring in the `applinks` entries. For example, if you specify the entries `applinks:*.mywebsite.com` and `applinks:*.users.mywebsite.com`, matching for the redirect URI `emily.users.mywebsite.com` is performed against the longer `*.users.mywebsite.com` entry. Note that an entry for `*.mywebsite.com` does not match `mywebsite.com` because of the period after the asterisk. To enable matching for both `*.mywebsite.com` and `mywebsite.com`, you need to provide a separate `applinks` entry for each.</br></li>
</ol>
  

<aside class="notice">Apple doc says to limit this list to no more than about 20 to 30 domains</aside>
 

<ol>
  <li value="9">Update the app delegate to respond appropriately when it receives the `NSUserActivity` object. After all above steps are completed perfectly, when the User click a universal link, the app will open up and the method <code>application:continueUserActivity:restorationHandler</code> will get called in <code>Appdelegate</code>. When iOS launches the the app after a User taps a universal link, you receive an <code>NSUserActivity</code> object with an <code>activityType</code> value of <code>NSUserActivityTypeBrowsingWeb</code>. The activity object’s <code>webpageURL</code> property contains the redirect URI that the user is accessing. The webpage URL property always contains an HTTPS URL, and you can use <code>NSURLComponents</code> APIs to manipulate the components of the URL.<br>For getting the URL parameters, use the function aside.</br><br>Also if you want to check if the app had opened by clicking a universal link or not in the `didFinishLaunchingWithOptions` method aside.</br>
  </li>
</ol>
<pre class="highlight http tab-http--inline"><code><span class="err">func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool {
    print("Continue User Activity called: ")
    if userActivity.activityType == NSUserActivityTypeBrowsingWeb {
        let url = userActivity.webpageURL!
        print(url.absoluteString)
        //handle url and open whatever page you want to open.
    }
    return true
}
</span></code></pre><pre class="highlight http tab-http--inline"><code><span class="err">//playground code..
var str = “https://google.com/contents/someotherpath?category=series&amp;contentid=1562167825"
let url = URL(string: str)
func queryParameters(from url: URL) -&gt; [String: String] {
let urlComponents = URLComponents(url: url, resolvingAgainstBaseURL: false)
var queryParams = [String: String]()
for queryItem: URLQueryItem in (urlComponents?.queryItems)! {
if queryItem.value == nil {
continue
}
queryParams[queryItem.name] = queryItem.value
}
return queryParams
}
// print the url parameters dictionary
print(queryParameters(from: url!))

//It will print [“category”: “series”, “contentid”: “1562167825”]
</span></code></pre><pre class="highlight http tab-http--inline"><code><span class="err">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil) -&gt; Bool {
 var isUniversalLinkClick: Bool = false
 if launchOptions[UIApplicationLaunchOptionsUserActivityDictionaryKey] {
 let activityDictionary = launchOptions[UIApplicationLaunchOptionsUserActivityDictionaryKey] as? [AnyHashable: Any] ?? [AnyHashable: Any]()
 let activity = activityDictionary[“UIApplicationLaunchOptionsUserActivityKey”] as? NSUserActivity ?? NSUserActivity()
 if activity != nil {
 isUniversalLinkClick = true
 }
 }
 if isUniversalLinkClick {
 // app opened via clicking a universal link.
 } else {
 // set the initial viewcontroller
 }
 return true
}
</span></code></pre><h2 id='5-2-app-links-on-android'>5.2. App Links on Android</h2>
<p>The App Links Assistant in Android Studio can help you create intent filters in your manifest and map existing URLs from your website to activities in your app. Follow below steps to configure the App links (as documented on <a href="https://developer.android.com/studio/write/app-link-indexing" target="blank">App Links official documentation</a>):</p>

<ol>
  <li>Add the intent filters to your manifest. Go through the your manifest and select Tools &gt; App Links Assistant. Click Open URL Mapping Editor and then click Add  at the bottom of the URL Mapping list to add a new URL mapping.</li>
  <li>Add details for the new URL mapping:
    <ul>
      <li>Entering your redirect URI in the <code>host</code> field.</li>
      <li>Add a <code>path</code>, <code>pathPrefix</code>, or <code>pathPattern</code> for the redirect URIs you want to map. For example, if you have a recipe-sharing app, with all the recipes available in the same activity, and your corresponding website's recipes are all in the same <code>/recipe directory</code>, use <code>pathPrefix</code> and enter <code>/recipe</code>. This way, the redirect URI http://www.recipe-app.com/recipe/grilled-potato-salad maps to the activity you select in the following step.</li>
      <li>Select the Activity the redirect URI should take Users to.</li>
      <li>Click OK.</li>
    </ul>
  <li>The App Links Assistant adds intent filters based on your URL mapping to the <code>AndroidManifest.xml</code> file, and highlights it in the <code>Preview</code> field. If the you would like to make any changes, click Open <code>AndroidManifest.xml</code> to edit the intent filter.</li>
</ol>
 

<aside class="notice">To support more links without updating the app, you should define a URL mapping that supports future redirect URIs.</aside>

<ol>
  <li value="4">To verify the URL mapping works properly, enter a URL in the Check URL Mapping field and click Check Mapping. If it's working correctly, the success message shows that the URL entered maps to the activity you selected.</li>
  <li>Handle incoming links. Once you have verified that the URL mapping is working correctly, you MUST add the logic to handle the intent he created.
    <ul>
      <li>Click Select Activity from the App Links Assistant.</li>
      <li>Select an activity from the list and click Insert Code.</li>
    </ul>
    <br>The App Links Assistant adds code to the activity's Java file, similar to the one aside.</br>
    <br>However, this code isn't complete on its own. You MUST now take an action based on the URI in <appLinkData>, such as display the corresponding content. For example, for the recipe-sharing app, the code might look like the sample aside.</br>
  </li>
</ol>
<pre class="highlight plaintext"><code>  protected void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  ...
  handleIntent(getIntent());
}

protected void onNewIntent(Intent intent) {
  super.onNewIntent(intent);
  handleIntent(intent);
}

private void handleIntent(Intent intent) {
    String appLinkAction = intent.getAction();
    Uri appLinkData = intent.getData();
    if (Intent.ACTION_VIEW.equals(appLinkAction) &amp;&amp; appLinkData != null){
        String recipeId = appLinkData.getLastPathSegment();
        Uri appData = Uri.parse("content://com.recipe_app/recipe/").buildUpon()
            .appendPath(recipeId).build();
        showRecipe(appData);
    }
}
</code></pre>
<ol>
  <li value="6">Associate the app with the redirect URI. After setting up URL support for your app, the App Links Assistant generates a Digital Asset Links file you can use to associate his website with your app. As an alternative to using the Digital Asset Links file, you can associate your site and app in Search Console. To associate the app and the website using the App Links Assistant, click Open the Digital Asset Links File Generator from the App Links Assistant:</li>
  <li>Enter your Site domain and Application ID.</li>
  <li>To include support in your Digital Asset Links file for Smart Lock for Passwords, select Support sharing credentials between the app and the website and enter your site's login URL. This adds the following string to your Digital Asset Links file declaring that your app and website share sign-in credentials: <code>delegate_permission/common.get_login_creds</code>.</li>
  <li>Specify the signing config or select a keystore file. Make sure to select the right config or keystore file for either the release build or debug build of your app. If you want to set up his production build, use the release config. If you want to test his build, use the debug config.</li>
  <li>Click <code>Generate Digital Asset Links</code> file.</li>
  <li>Once Android Studio generates the file, click <code>Save file</code> to download it.</li>
  <li>Upload the <code>assetlinks.json</code> file to redirect URI site, with read-access for everyone, at <code>https://<yoursite>/.well-known/assetlinks.json</code>.</li>
  <li>Click <code>Link and Verify</code> to confirm that you've uploaded the correct Digital Asset Links file to the correct location.
</ol>

<aside class="notice">The system verifies the Digital Asset Links file via the encrypted HTTPS protocol. Make sure that the assetlinks.json file is accessible over an HTTPS connection, regardless of whether your app's intent filter includes https.</aside>

<p><a name="SecurityLevels"></a></p>
<h2 id='5-3-security-levels-and-context-data'>5.3. Security levels and context data</h2>
<p>Depending on the required level of assurance your application MUST ensure the correct ‘security level’ is requested. Two ‘security levels’ are supported – ‘basic’ and ‘advanced’. Opting for ‘advanced’ will result in an itsme® code entry being enforced to validate the specific transaction (even if the user has activated touch ID/fingerprint). With the ‘basic’ level also touch ID/fingerprint next to the itsme® code are supported to validate the specific transaction.</p>

<p>The following table defines the different possible scenarios:</p>

<table><thead>
<tr>
<th style="text-align: left">Security level</th>
<th style="text-align: left">Login</th>
<th style="text-align: left">Share Data</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>basic</strong></td>
<td style="text-align: left">Allowed</td>
<td style="text-align: left">Allowed</td>
</tr>
<tr>
<td style="text-align: left"><strong>advanced</strong></td>
<td style="text-align: left">Allowed</td>
<td style="text-align: left">Allowed</td>
</tr>
</tbody></table>

<p>Next to the security levels, your application can also request additional security data to determine the context in which the transactions have been executed. The security data elements can, alone or in combination with each other, indicate a given risk exposure. By providing these elements, itsme® allows you to detect fraud attempts or effective fraudulent transactions. The security data elements that can be used to associate a risk exposure to a specific transaction are available in the section <a href="#SecurityDataElements">Capturing claims from the userInfo Endpoint</a>.</p>

<p><a name="RequestObjectByValue"></a></p>
<h2 id='5-4-using-the-request-parameter'>5.4. Using the request parameter</h2>
<p>The <code>request</code> parameter enables the Authentication Requests to be passed in a single, self-contained parameter and to be optionally signed and/or encrypted. It represents the request as a JWT whose claims are the parameters specified in section 3.2. This JWT is called a Request Object by value.</p>

<p>When <code>request</code> parameter is used, the OpenID Connect request parameter values contained in the referenced JWT supersede those passed using the OAuth 2.0 request syntax.</p>
<pre class="highlight http tab-http--inline"><code><span class="nf">GET</span> <span class="nn">/oidc/authorization</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s">    ?response_type=code%20id_token</span>
<span class="s">    &amp;client_id=s6BhdRkqt3</span>
<span class="s">    &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb</span>
<span class="s">    &amp;scope=openid</span>
<span class="s">    &amp;state=af0ifjsldkj</span>
<span class="s">    &amp;nonce=n-0S6_WzA2Mj</span>
<span class="s">    &amp;request=eyJhbGciOiJSUzI1NiIsImtpZCI6ImsyYmRjIn0.ew0KICJpc3MiOiA</span>
<span class="s">    iczZCaGRSa3F0MyIsDQogImF1ZCI6ICJodHRwczovL3NlcnZlci5leGFtcGxlLmN</span>
<span class="s">    vbSIsDQogInJlc3BvbnNlX3R5cGUiOiAiY29kZSBpZF90b2tlbiIsDQogImNsaWV</span>
<span class="s">    udF9pZCI6ICJzNkJoZFJrcXQzIiwNCiAicmVkaXJlY3RfdXJpIjogImh0dHBzOi8</span>
<span class="s">    vY2xpZW50LmV4YW1wbGUub3JnL2NiIiwNCiAic2NvcGUiOiAib3BlbmlkIiwNCiA</span>
<span class="s">    ic3RhdGUiOiAiYWYwaWZqc2xka2oiLA0KICJub25jZSI6ICJuLTBTNl9XekEyTWo</span>
<span class="s">    iLA0KICJtYXhfYWdlIjogODY0MDAsDQogImNsYWltcyI6IA0KICB7DQogICAidXN</span>
<span class="s">    lcmluZm8iOiANCiAgICB7DQogICAgICJnaXZlbl9uYW1lIjogeyJlc3NlbnRpYWw</span>
<span class="s">    iOiB0cnVlfSwNCiAgICAgIm5pY2tuYW1lIjogbnVsbCwNCiAgICAgImVtYWlsIjo</span>
<span class="s">    geyJlc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgImVtYWlsX3ZlcmlmaWVkIjogeyJ</span>
<span class="s">    lc3NlbnRpYWwiOiB0cnVlfSwNCiAgICAgInBpY3R1cmUiOiBudWxsDQogICAgfSw</span>
<span class="s">    NCiAgICJpZF90b2tlbiI6IA0KICAgIHsNCiAgICAgImdlbmRlciI6IG51bGwsDQo</span>
<span class="s">    gICAgICJiaXJ0aGRhdGUiOiB7ImVzc2VudGlhbCI6IHRydWV9LA0KICAgICAiYWN</span>
<span class="s">    yIjogeyJ2YWx1ZXMiOiBbInVybjptYWNlOmluY29tbW9uOmlhcDpzaWx2ZXIiXX0</span>
<span class="s">    NCiAgICB9DQogIH0NCn0.nwwnNsk1-ZkbmnvsF6zTHm8CHERFMGQPhos-EJcaH4H</span>
<span class="s">    h-sMgk8ePrGhw_trPYs8KQxsn6R9Emo_wHwajyFKzuMXZFSZ3p6Mb8dkxtVyjoy2</span>
<span class="s">    GIzvuJT_u7PkY2t8QU9hjBcHs68PkgjDVTrG1uRTx0GxFbuPbj96tVuj11pTnmFC</span>
<span class="s">    UR6IEOXKYr7iGOCRB3btfJhM0_AKQUfqKnRlrRscc8Kol-cSLWoYE9l5QqholImz</span>
<span class="s">    jT_cMnNIznW9E7CDyWXTsO70xnB4SkG6pXfLSjLLlxmPGiyon_-Te111V8uE83Il</span>
<span class="s">    zCYIb_NMXvtTIVc1jpspnTSD7xMbpL-2QgwUsAlMGzw</span>
</code></pre>
<p>The following validations should be done when using the <code>request</code> parameter:</p>

<ol>
  <li>The values for the <code>response_type</code> and <code>client_id</code> parameters MUST be filled in the Authentication Request, since they are REQUIRED in the OpenID Connect Core specifications. The values for these parameters MUST match those in the Request Object, if present.</li>
  <li>Even if a <code>scope</code> parameter is present in the Request Object value, a <code>scope</code> parameter – containing the <code>openid</code> scope value to indicate to the underlying OpenID Connect Core logic that this is an OpenID Connect request – MUST always be passed in the Authentication Request.</li>
  <li>The Request Object MAY be signed or unsigned (plaintext) using the <a href="https://belgianmobileid.github.io/slate/jose.html" target="blank">JSON Web Signature</a> (JWS). If signed, the Request Object SHOULD contain the claims <code>iss</code> (issuer) and <code>aud</code> (audience) as members. The <code>iss</code> value SHOULD be your Client ID. The <code>aud</code> value SHOULD be <code>https://merchant.itsme.be/oidc</code>.</li>
  <li>The Request Object MAY also be encrypted using <a href="https://belgianmobileid.github.io/slate/jose.html" target="blank">JSON Web Encryption</a> (JWE). In this case, it MUST be signed then encrypted, with the result being a Nested JWT, as defined in the <a href="https://belgianmobileid.github.io/slate/jose.html" target="blank">JSON Web Token</a> (JWT) section.</li>
  <li>The <code>request</code> and <code>request_uri</code> query parameters MUST NOT be included at the same time in Request Objects.</li>
</ol>

<p>Enclosed you will find a non-normative example of an Authorization Request using the <code>request</code> parameter.</p>

<p><a name="RequestUri"></a></p>
<h2 id='5-5-using-request_uri-parameter'>5.5. Using request_uri parameter</h2>
<p>The <code>request_uri</code> parameter enables the Authentication Requests to be passed by reference, rather than by value. This parameter is used identically to the <code>request</code> parameter, except that the Request Object value is retrieved from the resource at the specified URL.</p>

<p>When the <code>request_uri</code> parameter is used, the OpenID Connect request parameter values contained in the referenced JWT supersede those passed using the OpenID Connect Authorization Request syntax. However, parameters MAY also be passed using the OpenID Connect Authorization Request syntax even when a <code>request_uri</code> is used; this would typically be done to enable a cached, pre-signed (and possibly pre-encrypted) Request Object value to be used containing the fixed request parameters, while parameters that can vary with each request, such as <code>state</code> and  <code>nonce</code>, are passed as OpenID Connect parameters.</p>

<p>To be a valid OpenID Connect Authorization Request, it MUST include the <code>response_type</code> and <code>client_id</code> parameters, since they are REQUIRED by OpenID Connect Core 1.0 specifications. The values for these parameters MUST match those in the Request Object.</p>

<p>You need to store the Request Object resource either locally or remotely at a URL the the Authorization Server can access. This URL is the Request URI, <code>request_uri</code>.</p>

<p>Enclosed you will find a non-normative example of an Authorization Request using the <code>request_uri</code>parameter;</p>
<pre class="highlight plaintext"><code>GET /oidc/authorization HTTP/1.1
    response_type=code%20id_token
    &amp;client_id=s6BhdRkqt3
    &amp;request_uri=https%3A%2F%2Fclient.example.org%2Frequest.jwt
    %23GkurKxf5T0Y-mnPFCHqWOMiZi4VS138cQO_V7PZHAdM
    &amp;state=af0ifjsldkj&amp;nonce=n-0S6_WzA2Mj
    &amp;scope=openid
</code></pre>
      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="http">HTTP</a>
          </div>
      </div>
    </div>
  </body>
</html>
