
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>itsme® OpenID Connect documentation</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;,&quot;http&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">JSON</a>
              <a href="#" data-language-name="http">HTTP</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#1-introduction" class="toc-h1 toc-link" data-title="1-introduction">1. Introduction</a>
          </li>
          <li>
            <a href="#2-creating-sandbox" class="toc-h1 toc-link" data-title="2-creating-sandbox">2. Creating sandbox</a>
          </li>
          <li>
            <a href="#3-integrating-itsme-services" class="toc-h1 toc-link" data-title="3-integrating-itsme-services">3. Integrating itsme® services</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#3-1-checking-itsme-openid-configuration" class="toc-h2 toc-link" data-title="3-1-checking-itsme-openid-configuration">3.1. Checking itsme® OpenID Configuration</a>
                  </li>
                  <li>
                    <a href="#3-2-forming-an-authentication-request" class="toc-h2 toc-link" data-title="3-2-forming-an-authentication-request">3.2. Forming an authentication request</a>
                  </li>
                  <li>
                    <a href="#3-3-capturing-an-authorization-code" class="toc-h2 toc-link" data-title="3-3-capturing-an-authorization-code">3.3. Capturing an Authorization Code</a>
                  </li>
                  <li>
                    <a href="#3-4-supporting-universal-links-and-app-links-mechanism" class="toc-h2 toc-link" data-title="3-4-supporting-universal-links-and-app-links-mechanism">3.4. Supporting Universal Links and App Links mechanism</a>
                  </li>
                  <li>
                    <a href="#3-5-exchanging-the-authorisation-code" class="toc-h2 toc-link" data-title="3-5-exchanging-the-authorisation-code">3.5. Exchanging the authorisation code</a>
                  </li>
                  <li>
                    <a href="#3-6-managing-token-response" class="toc-h2 toc-link" data-title="3-6-managing-token-response">3.6. Managing Token Response</a>
                  </li>
                  <li>
                    <a href="#3-7-authenticating-the-user" class="toc-h2 toc-link" data-title="3-7-authenticating-the-user">3.7. Authenticating the User</a>
                  </li>
                  <li>
                    <a href="#3-8-requesting-id-claims-user-attibutes" class="toc-h2 toc-link" data-title="3-8-requesting-id-claims-user-attibutes">3.8 Requesting ID claims/user attibutes</a>
                  </li>
                  <li>
                    <a href="#3-9-obtaining-id-claims-user-attibutes" class="toc-h2 toc-link" data-title="3-9-obtaining-id-claims-user-attibutes">3.9 Obtaining ID claims/user attibutes</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#4-appendixes" class="toc-h1 toc-link" data-title="4-appendixes">4. Appendixes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#4-1-passing-request-parameters-as-jwts" class="toc-h2 toc-link" data-title="4-1-passing-request-parameters-as-jwts">4.1. Passing Request Parameters as JWTs</a>
                  </li>
                  <li>
                    <a href="#4-2-requests-signing-and-encryption" class="toc-h2 toc-link" data-title="4-2-requests-signing-and-encryption">4.2. Requests Signing and Encryption</a>
                  </li>
                  <li>
                    <a href="#4-3-universal-links-on-ios" class="toc-h2 toc-link" data-title="4-3-universal-links-on-ios">4.3. Universal Links on iOS</a>
                  </li>
                  <li>
                    <a href="#4-4-app-links-on-android" class="toc-h2 toc-link" data-title="4-4-app-links-on-android">4.4. App Links on Android</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a> --></li>
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='1-introduction'>1. Introduction</h1>
<p>itsme® is an identity checking system allowing Service Providers to use verified identities – through 4 services – for authentication and authorization on their web desktop, mobile web and in-app mobile applications:
<ul>
  <li>Login</li>
  <li>Confirm</li>
  <li>Share Data</li>
  <li>Sign</li>
</ul></p>

<p>The objective of this document is to provide all the information needed to integrate the Login and Share Data services using the <a href="http://openid.net/specs/openid-connect-core-1_0.html">OpenID Connect Core 1.0 specifications</a>.</p>

<p><a name="Onboarding"></a></p>
<h1 id='2-creating-sandbox'>2. Creating sandbox</h1>
<p>Before your application can use itsme® OpenID Login and Share Data services, you must set up a project in the <a href="https://brand.belgianmobileid.be/d/CX5YsAKEmVI7">itsme® B2B portal</a> to obtain credentials (<code>client_id</code>, ServiceCode,...), set a redirect URI, and customize the branding information that the Users see on the user-consent screen (e.g.: WYSIWYS screen) in the itsme® app. </p>

<aside class="notice"> The JWKSet URLs are used by our BE for the decryption and signature verification of the JWTokens present in the OpenID Connect flow. 
  <ul>
    <li>It must contain the root, the intermediate CA and the final public certifiate.</li>
    <li>You can specify only one JWKSet URL per environment.</li>
    <li>On the HTTPS protocol level, connections must be secured using trusted Root CA.</li>
    <li>In production, it is not possible the certificate is NOT self-signed (it can be self-signed in Sandbox)</li>
    <li>BMID is notified on time if the certificate or the URL is changed.</li>
    <li>There is no need for your client certificate. Currently the certificate is also used to protect the JWKSet and it is not directly linked to the SSL certificate.</li>
  </ul>
</aside>

<aside class="notice">You can find our JWKSet URL in the itsme® <a href="https://merchant.itsme.be/oidc/.well-known/openid-configuration">OpenID configuration file</a>, using the key `jwks_uri`.</aside>

<aside class="notice"> Redirect URIs (to which the User will be redirected after authentication in the itsme App) need to be whitelisted by our F5.
  <ul>
    <li>Multiple URLs can be whitelisted per service</li>
    <li>Additional parameters are not allowed and entire redirect_uri must match</li>
  </ul>  
</aside>
<h1 id='3-integrating-itsme-services'>3. Integrating itsme® services</h1>
<p>The itsme® Login and Share Data service integration is based on the <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth">Authorization Code Flow</a> of OpenID Connect 1.0. The Authorization Code Flow goes through the steps as defined in <a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeFlowSteps">OpenID Connect Core Authorization Code Flow Steps</a>, depicted in the following  <a href="https://www.draw.io/?lightbox=1&amp;highlight=0000ff&amp;edit=_blank&amp;layers=1&amp;nav=1&amp;title=Untitled%20Diagram.html#R7Vxbd6o4FP41PtZFCAF87HVOH6bTNZ1Zc%2BaRQlRWkTiAtZ1fP4mEWxIrYhC1Yx9aNnFjvi%2F7mtgRvF18%2FJJ4y%2FmvJMDRyDSCjxG8G5kmoD%2F0F5N85hLb5YJZEgZ8UCV4Cf%2FFXGhw6SoMcNoYmBESZeGyKfRJHGM%2Fa8i8JCHr5rApiZpPXXozLAlefC%2BSpX%2BFQTbPpa7pVPIfOJzNiycDe5LfWXjFYD6TdO4FZF0TwfsRvE0IyfK%2FFh%2B3OGLgFbjk73vYcrf8YAmOszZv4Li%2Fe9GKz41%2FruyzmGxCVnGA2XgwgjfreZjhl6Xns7trSi%2BVzbNFxG9zdTjJ8MfWjwTKidIVgskCZ8knHcLf4HBo%2BNqA%2FHJdAQ0K9OY1kG0u8zi3s1JxNX36B0dAjQY8PTSGhMM6PTisAeFApweHPSActgTHnylOJEjo5LLmvNMsIW%2F4lkQkoZKYxHTkzTSMIkHkReEsppc%2BBYMqhjcMqpB64Wt%2BYxEGAXuMEuiKCoOpJ3HG4wiAerAHoIk9krG3FNCbGqB3JOjDLF1gKrpeLr8PA3A4BtytDNx4%2FtsVjoPvQ4Pl7qQBGD3xMJF4eMHJe%2BgzJp4T8k7zROqSjEcG3JTB8m1YsQdkpbDLr0IlNZFrlopXgAZeOi9jZ40QERwKQPL5kyE3RsXl342YigMpfxdgowWDl8xwMWc1kjWokAKpQpbgyMvC9%2BYTVfDxJzyTkH6WKo7AJlG2GJxTskp8zN9Vz%2BVFRWZTURmgCkX5lCVFGzbLabcjuEXd0J3gtiQOxRgUGIOizbRlTFQkUa%2BRsRa1zdAmmcPGobFlM7WGJB3pMlNkNxVN%2BuO8RQE3NOd1ftGQ%2FDq6%2BHWcY%2FFb0FnjF4w32U6YhV7GciDPz0ISb0CkGNK35lnqySdBpqYKwRJCoiFnQWZfWZCiYWCOr1fZ%2FIkKf8f%2FrHCanQEVmloVSMhHgSVTUWYsuqmAsie0xvcbnGidMGcAmsbTavF6Fg0MXa1FJDAyUTAC%2B2JEbh9JyNcgXzJ3uXkcuhmhOybBSUifynC9I0k2JzMSe9FzJe1lERc2zSErK51GVSUjZulATO76nFw0r2dwtitH%2BJz180%2Fh4LFCfLFwWpJOljjesBc8hFFBNb2qh9Uti2Afor8kENh62BLrYgAmY9SNLzG3U6jSSNl%2BtfElUSbhrMvAAOqTsBZlUo0BMYi%2Fkiwji5w0gdSG8604dbXyyCEzxtBGkyZq%2FbhNUDxm7wbVLkVbOK0UFQPJdJrig3mX83M4vgvTZeQxXB8Dinw4pVTzEurFTzCl9fvkh2LxpMrYnZ7yQyQbJWK1bcXP2qNVbjxjZKiJOQebNVAvJmpanWOlaKQKVcc1UySbqc1Wwm%2BMr7Kjodz53HMFvEbEf%2Bsrxrr9ZEVS7tm192y67ZxxFwYHqVyocZW3a2Xhxlu2ZVToSY%2Bkgga5O4k%2F4kaEvrXQW0GD5J3zr8z2ROp%2BKNb9qlaJguey33jQQRsgQeaM6YSnJFlQMQ1%2Bm0zFi9J8mrWcpR9%2FWLM4w2yaHDDQ4TZXNzB7t4Fp8qwQNjnuvKuHhH1YCNy%2BrMmWY6PLYuMToZnrZxEVDTJl6evK93GaHroojpkmHZoViUR0LUfFbQRJkUZGz9I%2Fin1R2LIvKsaZTu5RPgMkIda939JY5wy5B28RRmyaP3D0jpm5KHISdl0UeyMTGpuXquJrlor1od2t5kjNVNEmxPyxa3NOUqTPuIpitbZUJs2isnSS26r9y%2FWWUPSWXbNJsUSRFGkk1JQIBWD8BzUpVhpu22MdvCzkQF3RfElyk5qyGdGqrM7ZzC5Fx%2B0GOHJfCMBxfvLceIyn5H%2FeG3QhsQLpyruk6Mi8y5kuMGuWni5JnMonW07YXZc9QKAnHot22vn80i5FRyZebh4BSzL4M6ZfWwu4mYIjeMB26U5VR14DF1EUlZHzCIdFnP2KosGPfjqD9lF1HgwZw9pLqIrdydiuvSZOK6PqYDCuXOicocEgxWnNvgzG3e98%2FCWf2kBiV6Zr4Scp0rjAFWUA2rOUv9iNe7FdiYot1PricRWGpOWbkYp8zWDMVCeftyRrF8uHePQZOgq%2FpvqatpZT6L5jTbDtADidIs%2FGVwqCvvJ0fuSlaeh%2F7c9qCQEcNfdggaV3Q2jYI6TS9rv4Hbuum0TlV%2BoO9pX0svr%2FIfnw6r%2BwwPv%2FAA%3D%3D">diagram</a>,</p>

<p><img src="https://lh3.googleusercontent.com/vi1iEAv0LtjFbvT30UE62rHDLu-fPFysH5oj1dpa_hVzaTbmKSV2Js_NjTCI7-5tXGVKgd8p4CQ" title="auth diag" alt="enter image description here" /></p>

<ol>
  <li>Your web desktop, mobile web or in-app mobile application (e.g.: The Relying Party) sends a request to itsme® (e.g.: OpenID Provider) to authenticate the User.</li>
  <li>itsme® authenticates the User by asking him
    <ul type>
      <li>to enter his MSISDN on the itsme® OpenID web page</li>
      <li>authorize the release of some information’s to your application</li>
      <li>to provide his credentials (password or fingerprint or FaceID)</li>
    </ul>
  
  If you are building a mobile web or in-app mobile application, the User don’t need to enter his MSISDN on the itsme® OpenID web page, he will directly be redirected to the itsme app via the Universal links and App links.</li>
  <li>Once the User has has authorized the request and has been authenticated the request itsme® will return an authorization code to your server component.</li>
  <li>Your server component contacts the token endpoint and exchanges the authorization code for an id token identifying the User and an access token, redirecting the user to your mobile or web application.</li>
  <li>You may request the additional user information from the UserInfo endpoint by presenting the access token obtained in the previous step.</li>
</ol>

<p>This flow is described in much more detail in the following sections.</p>
<h2 id='3-1-checking-itsme-openid-configuration'>3.1. Checking itsme® OpenID Configuration</h2>
<p>To simplify implementations and increase flexibility, OpenID Connect allows the use of a <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">Discovery document</a>, a JSON document containing key-value pairs which provide details about itsme® system configuration, such as 
<ul>
  <li>URIs of the authorization</li>
  <li>token</li>
  <li>UserInfo</li>
  <li>supported claims</li>
  <li>JWKSet URL</li>
</ul></p>

<p>The Discovery document for itsme® services may be retrieved from: <code>https://merchant.itsme.be/oidc/.well-known/openid-configuration</code>.</p>

<p><a name="AuthNRequest"></a></p>
<h2 id='3-2-forming-an-authentication-request'>3.2. Forming an authentication request</h2>
<p>First, you will form a HTTPS GET request that MUST be sent to the itsme® authorization endpoint. The itsme® authorization endpoint is <code>https://merchant.itsme.be/oidc/authorize</code>. This URI can be retrieved from the itsme® <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">Discovery document</a>, using the key <code>authorization_endpoint</code>.</p>

<aside class="notice">We strongly recommend to use only the HTTP `GET` method, since `POST` method will not be authorized when triggering the itsme App through the Universal Link mechanism (more informations about Universal links and App links can be found in <a href="#UniversalLinks">section 3.4</a>.</aside>

<p>The OpenID Connect Core Specification defines a number of mandatory and recommended parameters to integrate in the HTTPS GET query string:</p>
<pre class="highlight http tab-http--inline"><code><span class="err"> HTTP/1.1
 GET /authorize?response_type=code
 &amp;scope=openid%20profile%20email%20service%3Aclient.registration
 &amp;client_id=s6BhdRkqt3
 &amp;state=af0ifjsldkj
 &amp;redirect_uri=https%3A%2F%2Fclient.example.org%2Fcb HTTP/1.1
 Host: server.itsme.be
</span></code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>client_id</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be the client identifier (e.g. : ParterCode) you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>response_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This defines the processing flow to be used when forming the response. Because itsme® uses the Authorization Code Flow as described above, this value MUST be <code>code</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>scope</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The scope parameter allows the application to express the desired scope of the access request. It MUST contain the value <code>openid</code> and <code>service: service_code</code>, the itsme® service you want to use as defined for your application in the <a href="#Onboarding">itsme® B2B portal</a>. <br>The <code>openid</code> scope can return standard user attributes (these claims are:<code>iss</code>, <code>aud</code>, <code>exp</code>, <code>iat</code> and <code>at_hash</code>) in the id_token and/or in the response from the /userinfo endpoint.</br><br>Applications can ask for additional scopes, separated by spaces, to request more information about the user. The following additional scopes apply:<ul><li>profile: will request the claims representing basic profile information. These are <code>family_name</code>, <code>given_name</code>, <code>gender</code>, <code>birthdate</code> and <code>locale</code>.</li><li>email: will request the <code>email</code> and <code>email_verified</code> claims.</li></ul>For more information on user attributes or claims, please consult the <a href="#Data">ID claims</a> section.</br><br>An HTTP ERROR <code>not_implemented</code> will be returned if the required values are not specified.</br><br>Unrecognised values will be ignored.</br><br>Note: you&#39;ll need to define one scope for each itsme® service you want to use.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This is the URI to which the authentication response should be sent. This must exactly match one of the redirection URIs defined when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>state</strong></td>
<td style="text-align: left">An appropriate value is strongly RECOMMENDED</td>
<td style="text-align: left">It is recommended that you use this parameter to maintain state between the request and the callback. Typically, Cross-Site Request Forgery (CSRF, XSRF) mitigation is done by cryptographically binding the value of this parameter with a browser cookie.</td>
</tr>
<tr>
<td style="text-align: left"><strong>nonce</strong></td>
<td style="text-align: left">An appropriate value is strongly RECOMMENDED</td>
<td style="text-align: left">String value used to associate a session with an ID token, and to mitigate replay attacks. The value is passed through unmodified from the authentication request to the id token. Sufficient entropy MUST be present in the <code>nonce</code> values used to prevent attackers from guessing values. See <a href="http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes">the OpenID Connect Core specifications</a> for more information.</td>
</tr>
<tr>
<td style="text-align: left"><strong>login_hint</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Hint to the Authorization Server about the login identifier the User might use to log in (if necessary).<br>This value MUST be a phone number in the format specified for the <code>phone_number</code> claim: <code>&lt;countrycode&gt;+&lt;phonenumber&gt;</code>. E.g. <code>login_hint=32+123456789</code>.</br><br><code>login_hint</code> with invalid syntax will be ignored.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>display</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">ASCII string value that specifies how the Authorization Server displays the authentication and consent user interface pages to the User. MUST be <code>page</code> if provided.<br>Other values will yield an HTTP ERROR <code>not_implemented</code>.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>prompt</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Space delimited, case sensitive list of ASCII string values that specifies whether the Authorization Server prompts the User for reauthentication and consent. MUST be <code>consent</code> if provided.</td>
</tr>
<tr>
<td style="text-align: left"><strong>ui_locales</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">User&#39;s preferred languages and scripts for the user interface (e.g.: OpenID web page). Supported values are: {“fr”, “nl”, “en”, “de”}. Any other value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>max_age</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Specifies the allowable elapsed time in seconds since the last time the user was actively authenticated by itsme®. If the elapsed time is greater than this value, the authentication system MUST attempt to actively re-authenticate the User. As itsme® does not maintain a session mechanism, an active authentication is always required.</td>
</tr>
<tr>
<td style="text-align: left"><a name="acrvalues"><strong>acr_values</strong></a></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">Space-separated string that specifies the acr values that the Authorization Server is being requested to use for processing this Authentication Request, with the values appearing in order of preference.<br>2 values are supported:<ul><li>Basic level - let the User to choose either fingerprint usage (if device is compatible) or PIN<br><code>tag:itsmetag:sixdots.be,2016-06:acr_basic</code></br></li><li>Advanced level - force the User to use PIN<br><code>tag:itsmetag:sixdots.be,2016-06:acr_advanced</code></br></li></ul>When multiple values are provided only the most constraining will be used (advanced &gt; basic). If not provided basic level will be used.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>claims</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter is used to request that specific claims be returned. The value is a JSON object listing the requested claims.<br>Usage of claims parameter in the request object is recommended over this parameter as it will be signed in the JWT token, and the returned data will be encrypted.</br><br>See <a href="#Data">User Data</a> for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>request</strong></td>
<td style="text-align: left">Optional</td>
<td style="text-align: left">This parameter enables OpenID Connect requests to be passed in a single, self-contained parameter and to be optionally signed and/or encrypted. The parameter value is a Request Object value.<br>See <a href="#JWTRequest">Passing Request Parameters as JWTs</a> for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>response_mode</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>id_token_hint</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>claims_locales</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>request_uri</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
<tr>
<td style="text-align: left"><strong>registration</strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">Any supplied value will be ignored.</td>
</tr>
</tbody></table>

<p><a name="AuthNResponse"></a></p>
<h2 id='3-3-capturing-an-authorization-code'>3.3. Capturing an Authorization Code</h2><h3 id='capturing-a-successful-authorisation-code'>Capturing a successful Authorisation Code</h3>
<p>If the User is successfully authenticated and authorizes access to the data requested, itsme® will return an authorisation code to your server component. This is achieved by returning an Authentication Response, which is a HTTP 302 redirect request to the <code>redirect_uri</code> specified previously in the authentication request.</p>
<pre class="highlight http tab-http--inline"><code><span class="err"> </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="s"> Location: https://client.example.org/cb?</span>
<span class="s"> code=SplxlOBeZQQYbYS6WxSbIA&amp;</span>
<span class="s"> state=af0ifjsldkj</span>
</code></pre>
<p>The response will contain:</p>

<table><thead>
<tr>
<th style="text-align: center">Parameter</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: center"><strong>code</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The code parameter holds the authorization code which is a string value. The content of authorization code is opaque for you. This code has a lifetime of 3 minutes.</td>
</tr>
<tr>
<td style="text-align: center"><strong>state</strong></td>
<td style="text-align: left">If provided</td>
<td style="text-align: left">The state parameter will be returned if you provided a value in the Authentication request. You should validate that the value returned matches the one supplied in the authentication request. The state value can additionally be used to mitigate against XSRF attacks by cryptographically binding the value of this parameter with a browser cookie.</td>
</tr>
</tbody></table>
<h3 id='handling-authentication-error-response'>Handling Authentication Error Response</h3>
<p>If the request fails due to a missing, invalid, or mismatching redirection URI, or if the client identifier is missing or invalid, the authorization server SHOULD inform the User of the error and MUST NOT automatically redirect him to the invalid redirection URI. </p>

<p>If the User denies the authentication request or if the request fails for reasons other than a missing or invalid redirection URI, itsme® will return an error response to your application. As for a successful response this is achieved by returning a HTTPS 302 redirect request to the redirection_uri specified in the authentication request. Following parameters could be added to the query component of the redirection_uri:</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">https://client.example.org/cb?</span>
<span class="s">error=invalid_request</span>
<span class="s">&amp;error_description=Unsupported%20response_type%20value</span>
<span class="s">&amp;state=af0ifjsldkj </span>
</code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>error</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Error type.</td>
</tr>
<tr>
<td style="text-align: left"><strong>error_description</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Indicating the nature of the error</td>
</tr>
</tbody></table>

<p>The following table describes the various error codes that can be returned in the <code>error</code> parameter of the error response:</p>

<table><thead>
<tr>
<th style="text-align: left">Error</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>interaction_required</strong></td>
<td style="text-align: left">The Authorization Server requires User interaction of some form to proceed.</td>
</tr>
<tr>
<td style="text-align: left"><strong>invalid_request_object</strong></td>
<td style="text-align: left">The <code>request</code> parameter contains an invalid Request Object.</td>
</tr>
<tr>
<td style="text-align: left"><strong>request_uri_not_supported</strong></td>
<td style="text-align: left">This error is returned because itsme® does not support use of the <code>request_uri</code> parameter defined in the JWTs.</td>
</tr>
<tr>
<td style="text-align: left"><strong>registration_not_supported</strong></td>
<td style="text-align: left">This error is returned because itsme® does not support use of the <code>registration</code> parameter.</td>
</tr>
</tbody></table>

<p>All other HTTPS errors unrelated to OpenID Connect Core will be returned to the User using the appropriate HTTPS status code.</p>

<p><a name="UniversalLinks"></a> </p>
<h2 id='3-4-supporting-universal-links-and-app-links-mechanism'>3.4. Supporting Universal Links and App Links mechanism</h2>
<p><a href="https://developer.apple.com/ios/universal-links/">Universal links</a> and <a href="https://developer.android.com/studio/write/app-link-indexing">App links</a> are standard web links (http://mydomain.com) that point to both a web page and a piece of content inside an app. When a Universal Link is opened, the app OS checks to see if any installed app is registered for that domain. If so, the app is launched immediately without ever loading the web page. If not, the web URL is loaded into the webbrowser.</p>

<p>An App link is the Android version of the Universal link.</p>

<p>How do Universal Links work in iOS and Android ? Before Universal Links, the primary mechanism to open up an app when it was installed was by trying to redirect to an app’s URI scheme  in the web browser. But there was no way to check if the app was installed or not. This meant that developers would try to call the URI scheme 100% of the time, in the off chance that the app was installed, then fallback gracefully to the App Store or Google Play Store when not by using a timer.</p>

<p>iOS Universal Links and Android App Links were intended to fix this. Instead of opening up the web browser first when a link is clicked, the OS will check if a Universal Link has been registered (a file should be there in the domain which contains the bundle id of the app and the paths the app should open) for the domain associated with the link, then check if the corresponding app is installed. If the app is currently installed, it will be opened. If it’s not, the web browser will open and the HTTPS link will load.</p>

<p>Functionally, it will allow you to have a single link that will either open your desktop web application, your mobile app or your mobile site on the User’s device.</p>

<p>The specifications for the implementation of Universal links and App links can be found in the <a href="#Appendix">Appendix</a>.</p>
<h2 id='3-5-exchanging-the-authorisation-code'>3.5. Exchanging the authorisation code</h2>
<p><a name="tokenEndpoint"></a> 
Once your server component has received an <a href="#AuthNResponse">authorization code</a>, your server can exchange it for an Access token and an ID token.</p>

<aside class="notice">You might also read in the OpenID Connect Core specification about the Refresh token, but we don't support them (we don't implement any session mechanism).</aside>

<p>Your server makes this exchange by sending an HTTPS POST request to the itsme® token endpoint URI <code>https://merchant.itsme.be/oidc/token</code>. This URI can be retrieved from the itsme® <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">Discovery document</a> using the key <code>token_endpoint</code>.</p>

<aside class="notice"> An authorization code can only be exchanged once. Attempting to re-exchange a code will generate a bad request response, outlined below in the section Handling Token Error Response. </aside>

<p>The request MUST include the following parameters in the <code>POST</code> body:</p>
<pre class="highlight http tab-http--inline"><code><span class="err">GET /oidc/authorization?response_type=code
&amp;client_id=yourpartnercode
&amp;yourredirecturl
&amp;scope=openid+service%3Ayourservicecode+profile+
&amp;claims={"userinfo":{" tag:sixdots.be,2016-06:claim_nationality": null},
"id_token":{"auth_time": {"essential": true},"acr_values
{"value":["tag:sixdots.be,2016-06:acr_advanced"]
}}}&amp;state=anystate&amp;nonce=anonce&amp;prompt=login&amp;max_age=1
</span></code></pre>
<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Required</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>grant_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be set to <code>authorization_code</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>code</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The Authorization Code received in response to the Authentication Request.</td>
</tr>
<tr>
<td style="text-align: left"><strong>redirect_uri</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">The redirection URI supplied in the original Authentication Request. This is the URL to which you want the User to be redirected after the authorization is complete.</td>
</tr>
<tr>
<td style="text-align: left"><strong>client_assertion</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">To ensure that the request is genuine and that the tokens are not returned to a third party, you will be authenticated when making the token request.<br>The OpenID Connect Core Specification support multiple authentication methods, but itsme® only supports <code>private_key_jwt</code>. This authentication method uses a JWT signed with a public key you have registered. The JWT MUST be sent as the value of a client_assertion parameter.</br><br>See <a href="http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication">section 9</a> of the OpenID Connect Core specification for more information.</br></td>
</tr>
<tr>
<td style="text-align: left"><strong>client_assertion_type</strong></td>
<td style="text-align: left">Required</td>
<td style="text-align: left">This MUST be set to <code>urn:ietf:params:oauth:client-assertion-type:jwt-bearer</code>.</td>
</tr>
</tbody></table>

<p>According to the <code>private_key_jwt</code> client authentication method, the <code>client_assertion</code> JWT must contain the following properties:</p>

<table><thead>
<tr>
<th style="text-align: left">Property</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>iss</strong></td>
<td style="text-align: left">The issuer of the <code>private_key_jwt</code>. This MUST contain the <code>client_id</code>. This is the client identifier (e.g. : ParterCode) you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sub</strong></td>
<td style="text-align: left">The subject of the <code>private_key_jwt</code>. This MUST contain the <code>client_id</code>. This is the client identifier (e.g. : ParterCode) you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>aud</strong></td>
<td style="text-align: left">Value that identifies the Authorization Server as an intended audience. This MUST be the itsme® token endpoint URL : <code>https://merchant.itsme.be/oidc/token</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>jti</strong></td>
<td style="text-align: left">A unique identifier for the token, which can be used to prevent reuse of the token. These tokens MUST only be used once.</td>
</tr>
<tr>
<td style="text-align: left"><strong>exp</strong></td>
<td style="text-align: left">Expiration time on or after which the ID Token MUST NOT be accepted for processing.</td>
</tr>
</tbody></table>

<p><a name="TokenResponse"></a></p>
<h2 id='3-6-managing-token-response'>3.6. Managing Token Response</h2><h3 id='extracting-a-successful-token-response'>Extracting a successful Token response</h3>
<p>If the Token request has been sucessfully validated we will return an HTTP 200 OK response including ID and Access tokens as in the example aside:</p>
<pre class="highlight http tab-http--inline"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="s">  Content-Type: application/json</span>
<span class="s">  Cache-Control: no-store</span>
<span class="s">  Pragma: no-cache</span>

  {
   "access_token": "SlAV32hkKG",
   "token_type": "Bearer",
   "expires_in": 3600,
   "id_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6IjFlOWdkazcifQ.ewogImlzc
     yI6ICJodHRwOi8vc2VydmVyLmV4YW1wbGUuY29tIiwKICJzdWIiOiAiMjQ4Mjg5
     NzYxMDAxIiwKICJhdWQiOiAiczZCaGRSa3F0MyIsCiAibm9uY2UiOiAibi0wUzZ
     fV3pBMk1qIiwKICJleHAiOiAxMzExMjgxOTcwLAogImlhdCI6IDEzMTEyODA5Nz
     AKfQ.ggW8hZ1EuVLuxNuuIJKX_V8a_OMXzR0EHR9R6jgdqrOOF4daGU96Sr_P6q
     Jp6IcmD3HP99Obi1PRs-cwh3LO-p146waJ8IhehcwL7F09JdijmBqkvPeB2T9CJ
     NqeGpe-gccMg4vfKjkM8FcGvnzZUN4_KSP0aAp1tOJ1zZwgjxqGByKHiOtX7Tpd
     QyHE5lcMiKPXfEIQILVq0pc_E2DzL7emopWoaoZTF_m0_N0YzFC6g6EJbOEoRoS
     K5hoDalrcvRYLSrQAZZKflyuVCyixEoV9GfNQC3_osjzw2PAithfubEEBLuVVk4
     XUVrWOLrLl0nx7RkKU8NXNHq-rvKMzqg"
  }

</code></pre>
<p>The response body will include the following parameters:</p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong><a href="#actoken"><code>access_token</code></a></strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The Access token which may be used to access the UserInfo endpoint.</td>
</tr>
<tr>
<td style="text-align: left"><strong><a href="http://openid.net/specs/openid-connect-core-1_0.html#TokenResponse"><code>token_type</code></a></strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Set to <code>Bearer</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong><a href="#idtoken"><code>id_token</code></a></strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The Base64URL encoded id token corresponding to the Authentication Request.</td>
</tr>
<tr>
<td style="text-align: left"><strong><a href="http://openid.net/specs/openid-connect-core-1_0.html#CodeIDToken"><code>at_hash</code></a></strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">itsme® does not provide any value for this parameter.</td>
</tr>
<tr>
<td style="text-align: left"><strong><a href="#rfshtoken"><code>refresh_token</code></a></strong></td>
<td style="text-align: left">Not supported</td>
<td style="text-align: left">itsme® does not provide any value for this parameter as it only maintains short-lived session to enforce re-authentication.</td>
</tr>
</tbody></table>

<p>The ID token MUST contain the following fields:</p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Returned</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>iss</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Identifier of the issuer of the ID token.</td>
</tr>
<tr>
<td style="text-align: left"><strong>sub</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">An identifier for the User (e.g.: UserCode), unique among all itsme® accounts and never reused. Use <code>sub</code> in the application as the unique-identifier key for the User.</td>
</tr>
<tr>
<td style="text-align: left"><strong>aud</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Audience of the ID token. This MUST contain the <code>client_id</code>. This is the client identifier (e.g. : ParterCode) you received when registering your application in the <a href="#Onboarding">itsme® B2B portal</a>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>exp</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Expiration time on or after which the ID Token MUST NOT be accepted for processing.</td>
</tr>
<tr>
<td style="text-align: left"><strong>iat</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The time the ID token was issued, represented in Unix time (integer seconds).</td>
</tr>
<tr>
<td style="text-align: left"><strong>auth_time</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">The time the User authentication occurred, represented in Unix time (integer seconds).</td>
</tr>
<tr>
<td style="text-align: left"><strong>nonce</strong></td>
<td style="text-align: left">If provided</td>
<td style="text-align: left">String value used to associate a session with an ID token, and to mitigate replay attacks. The value is passed through unmodified from the Authentication request to the ID token. Sufficient entropy MUST be present in the <code>nonce</code> values used to prevent attackers from guessing values. See <a href="http://openid.net/specs/openid-connect-core-1_0.html#NonceNotes">the OpenID Connect Core specifications</a> for more information.</td>
</tr>
<tr>
<td style="text-align: left"><strong>acr</strong></td>
<td style="text-align: left">Always</td>
<td style="text-align: left">Possible values: <code>tag:sixdots.be,2016-06:acr_basic</code> and <code>tag:sixdots.be,2016-06:acr_advanced</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>amr</strong></td>
<td style="text-align: left">Never</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left"><strong>azp</strong></td>
<td style="text-align: left">Never</td>
<td style="text-align: left"></td>
</tr>
</tbody></table>
<h3 id='handling-token-error-response'>Handling Token Error Response</h3>
<p>If the Token request is invalid or unauthorized an HTTP 400 response will be returned as in the example:
<code>http--inline
HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store
Pragma: no-cache
{
  &quot;error&quot;: &quot;invalid_request&quot;
}
</code>
The response will contain an error parameter and optionally <code>error_description</code> and <code>error_uri</code> parameters. The <code>error_uri</code> parameter may be used by implementations to specify a human-readable web page with information about the error, used to provide the client developer with additional information about the error.</p>
<h2 id='3-7-authenticating-the-user'>3.7. Authenticating the User</h2>
<p>After obtaining the user ID and Access token, you should query your database to check if you know the User, or not. If the User already exists in your database, you should start an application session for that User.</p>

<p>If the User does not exist in the your database, one of the following scenario should be implemented to link the UserCode to the correct user account:
<ul>
  <il>If you requested user attributes in the Authentication request, you can check if these data&#39;s match those you have in your database and automatically link User&#39;s UserCode to the correct User account on your side.</il>
  <il>If you requested user attributes in the Authentication request but you can&#39;t match with certainty the provided data&#39;s with the one from your database, you could  redirect the User to the new-user sign-up flow. You may be able to auto-register the User based on the information received from itsme®, or at the very least you may be able to pre-populate many of the fields that are required on the registration form (under the condition you requested the user attributes in the Authentication request).</il>
  <il>If you didn&#39;t request user attributes in the Authentication request, simply ask the user to authenticate with his usual credentials and link the UserCode to his account on your side.</il>
</ul></p>

<p>All these scenario&#39;s are depicted in the diagrams below:</p>

<p><img src="LinkUserAuto.png" alt="Automatically linking user accounts"></p>

<p><img src="LinkUser.png" alt="Picture illustrates possibilities for linking user accounts"></p>

<p><a name="Data"></a></p>
<h2 id='3-8-requesting-id-claims-user-attibutes'>3.8 Requesting ID claims/user attibutes</h2>
<p>OpenID Connect Core specifications also allow your application to obtain basic profile information about them in a interoperable way. </p>

<p>Following the OpenID Connect Core specifications, there are 2 ways to request ID claims/user attributes for a specific User:
<ul>
  <il>using the <code>scope</code> parameter in the Authentication request</il>
  <il>using the <code>claims</code> parameter in the Authentication request</il>
</ul></p>
<h3 id='using-scope-parameter-to-request-claims'>Using <code>scope</code> parameter to request claims</h3>
<p><a name id="decClaim"></a></p>

<p>The scope parameter allows the application to express the desired scope of the access request. As stated before, it MUST contain the value <code>openid</code> and <code>service: service_code</code>, the itsme® service you want to use as defined for your application in the <a href="#Onboarding">itsme® B2B portal</a>. </p>

<p>The basic claims returned for the <code>openid</code> value are the <code>sub</code> claim - which uniquely identifies the user (e.g.: UserCode), the <code>iss</code>, <code>aud</code>, <code>exp</code>, <code>iat</code> and <code>at_hash</code>. </p>

<p>Your applications can ask for additional scopes to request more information about the User. The following additional scopes apply:</p>

<table><thead>
<tr>
<th style="text-align: left">ID claims</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>profile</strong></td>
<td style="text-align: left">This MUST be set to <code>profile</code>. It will request the claims representing basic profile information. These are <code>family_name</code>, <code>given_name</code>, <code>gender</code>, <code>birthdate</code> and <code>locale</code></td>
</tr>
<tr>
<td style="text-align: left"><strong>email</strong></td>
<td style="text-align: left">This MUST be set to <code>email</code>. It will request the <code>email</code> and <code>email_verified</code> claims.</td>
</tr>
<tr>
<td style="text-align: left"><strong>phone</strong></td>
<td style="text-align: left">This MUST be set to <code>phone</code>. It will request the <code>phone_number</code> and <code>phone_number_verified</code> claims.</td>
</tr>
<tr>
<td style="text-align: left"><strong>address</strong></td>
<td style="text-align: left">This MUST be set to <code>address</code>. It will request the <code>street_address</code>, <code>locality</code>, <code>postal_code</code> and <code>country</code></td>
</tr>
</tbody></table>
<h3 id='using-claims-parameter-to-request-claims'>Using <code>claims</code> parameter to request claims</h3>
<p>Some specific data&#39;s cannot be requested by using <code>scope</code> parameter. However, you can still add custom claims in the <code>claims</code> parameter, but they must conform to a namespaced format to avoid possible collisions with those requested through the <code>scope</code> parameter. </p>

<p>Here are the custom claims you can request:</p>

<table><thead>
<tr>
<th style="text-align: left">ID claims</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left"><strong>nationality</strong></td>
<td style="text-align: left">This MUST be set to <code>tag:itsmetag:sixdots.be,2016-06:claim_nationality</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>place of Birth - city</strong></td>
<td style="text-align: left">This MUST be set to <code>tag:itsmetag:sixdots.be,2016-06:claim_city_of_birth</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>place of Birth - country</strong></td>
<td style="text-align: left">This MUST be set to<code>tag:itsmetag:sixdots.be,2016-06:claim_country_of_birth</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>e-ID Metadata</strong></td>
<td style="text-align: left">This MUST be set to<code>tag:itsmetag:sixdots.be,2016-06:claim_eid</code>. It will request a JSON object with the following keys:<br><ul><li><code>eid</code> - the eID card serial number.</br></li><li><code>issuance_locality</code> - the eID card issuance locality.</br></li><li><code>validity_from</code> - the eID card validity “from” date.</br></li><li><code>validity_to</code> - the eID card validity “to” date.</br></li><li><code>certificate_validity</code> - the eID card certificate validity.</br></li><li><code>read_date</code> - the data extraction date. The date is encoded using ISO 8601 UTC (timezone) date format (example: 2017-04-01T19:43:37+0000).</br></li></ul></td>
</tr>
<tr>
<td style="text-align: left"><strong>passport Number</strong></td>
<td style="text-align: left">Simple string containing the user’s Passport Serial Number. This MUST be set to <code>tag:sixdots.be,2017-05:claim_passport_sn</code>.</td>
</tr>
<tr>
<td style="text-align: left"><strong>device</strong></td>
<td style="text-align: left">This MUST be set to <code>tag:sixdots.be,2017-05:claim_device</code>. It will request a JSON object with the following keys:<br><ul><li><code>os</code> - the device operating system. The returned values will be <code>ANDROID</code>or <code>iOS</code>.</br></li><li><code>appName</code> - the application name.</br></li><li><code>appRelease</code> - the application current release.</br></li><li><code>deviceLabel</code> - the name of the device.</br></li><li><code>debugEnabled</code> - if debug mode is activated.</br></li><li><code>deviceId</code> - the device identifier.</br></li><li><code>osRelease</code> - the version of the OS running on your device.</br></li><li><code>manufacturer</code> - the brand of the device manufacturer.</br></li><li><code>hasSimEnabled</code> - it tells you if a SIM card is installed in the device. The returned value is always <code>true</code> as long as itsme® can&#39;t be installed on tablets.</br></li><li><code>deviceLockLevel</code></br></li><li><code>smsEnabled</code></br></li><li><code>rooted</code> - the returned value is always <code>false</code> as long as itsme® can&#39;t be used on a jailbreaked/rooted device.</br></li><li><code>imei</code> - the device IMEI value.</br></li><li><code>deviceModel</code> - model of the device.</br></li><li><code>msisdn</code> - the User’s phone number.</br></li><li><code>sdkRelease</code></br></li></ul></td>
</tr>
<tr>
<td style="text-align: left"><strong>transaction Info</strong></td>
<td style="text-align: left">This MUST be set to <code>tag:sixdots.be,2017-05:claim_transaction_info</code>. It will request a JSON object with the following keys:<br><ul><li><code>securityLevel</code> - the security level used during transaction. The returned values could be <code>SOFT_ONLY</code>, <code>SIM_ONLY</code> or <code>SIM_AND_SOFT</code>.</br></li><li><code>bindLevel</code> - it tells you if the user account is bound to a SIM card or not, at the time the transaction occurred. The returned values could be <code>SOFT_ONLY</code>, <code>SIM_ONLY</code> or <code>SIM_AND_SOFT</code>.</br></li><li><code>mcc</code> - the Mobile Country Code. The returned value is an Integer (three digits) representing the mobile network country.</br></li></ul></td>
</tr>
<tr>
<td style="text-align: left"><strong>e-ID Picture</strong></td>
<td style="text-align: left">This MUST be set to <code>tag:sixdots.be,2017-05:2017-05:claim_photo</code>.</td>
</tr>
</tbody></table>
<h2 id='3-9-obtaining-id-claims-user-attibutes'>3.9 Obtaining ID claims/user attibutes</h2>
<p>All claims requested in the Autentication request (see the <a href="#Data">previous</a> section for more informations) can be returned in the <code>id_token</code> and/or in the response from the itsme® UserInfo endpoint (depending on the type of request).</p>
<h3 id='getting-data'>Getting Data</h3>
<p>As per the <a href="http://openid.net/specs/openid-connect-core-1_0.html#UserInfoRequest">OpenID Connect specification</a>, depending on how you declared claims in the Authentication Request, you will receive the user data from:
- The UserInfo Endpoint
- The Token Endpoint, in the ID Token
<aside class="success">Should there be 2 calls to itsme(r) for this schedule, one for Token Request &amp; one for UserInfo Request?<br>
Indeed, You need to perform two Back-End to Back-End calls:<br>
- The Token Request<br>
- The UserInfo Request<br>
On top of this, the Authorization Request (AuthN Request in the schedule) consists of an HTTP redirection to the OpenID webpage of BMID. The content of this HTTP request is to be crafted by your system, it is actually a third call from your side to BMID, this one being Front-End to Back-End.</aside></p>
<h4 id='userinfo-endpoint'>UserInfo Endpoint</h4>
<p>As per the <a href="http://openid.net/specs/openid-connect-core-1_0.html#UserInfoRequest">OpenID Connect specification</a>.</p>

<p>If you declared claims with <code>scope</code> values or if you declared claims in the <code>userinfo</code> part of the <code>claims</code> parameter in the <code>request</code> object, you will receive the end user data from the UserInfo Endpoint.</p>

<p>The UserInfo endpoint returns previously consented user profile information to the client app. For that a valid access token is required.</p>

<p>Your server sends the User Info Request using either HTTP  <code>GET</code>  or HTTP  <code>POST</code> method. The Access Token obtained from an Authentication Request must be sent as a Bearer Token. It is recommended that the request use the HTTP  <code>GET</code>method and the Access Token be sent the using the  <code>Authorization</code>  header field. The HTTP request is sent to the User Info endpoint, which you should retrieve from the  <a href="https://merchant.itsme.be/oidc/.well-known/openid-configuration">Discovery document</a>  using the key  <strong>userinfo_endpoint</strong>.</p>

<p>The content type of the response will be <code>application/JWT</code>. The response will be signed and encrypted. </p>

<p>The UserInfo endpoint can be accessed only with a valid <strong>access_token</strong> and for a very limited duration after end user authentication. There must be <em>less than 3 minutes</em> between the creation of the user action to be confirmed by the end user on his mobile device, and the access to the User Info Endpoint.
The Access Token will define the list of Data that will be provided back to the client. In order to request specific claims, you can  <a href="https://stackedit.io/app#stClaims">use scopes</a>  in the Authentication Request and/or  <a href="https://stackedit.io/app#Claims-Request">use the claims parameter</a>  of the  request Object.</p>
<h5 id='user-info-request-specification'>User info Request Specification</h5>
<p>As per specified <a href="http://openid.net/specs/openid-connect-core-1_0.html#UserInfoRequest">OIDC UserInfo Request</a>.</p>

<p>The Client sends the UserInfo Request using either HTTP  GET  or HTTP  POST. The Access Token obtained from an OpenID Connect Authentication Request MUST be sent as a Bearer Token, per Section 2 of  <a href="http://openid.net/specs/openid-connect-core-1_0.html#RFC6750">OAuth 2.0 Bearer Token Usage</a>  [RFC6750].</p>

<aside class="success">It is recommended that using HTTP GET request method and  sending Access Token by using the Authorization header field.</aside>
<pre class="highlight http tab-http--inline"><code><span class="err">GET /userinfo HTTP/1.1 
Host: server.example.com 
Authorization: Bearer SlAV32hkKG
</span></code></pre>
<table><thead>
<tr>
<th>Parameter</th>
<th>Comment</th>
</tr>
</thead><tbody>
<tr>
<td>acr</td>
<td>Possible values: <br><code>tag:sixdots.be,2016-06:acr_basic</code><br><code>tag:sixdots.be,2016-06:acr_advanced</code></td>
</tr>
<tr>
<td>amr</td>
<td>Won’t be provided</td>
</tr>
<tr>
<td>azp</td>
<td>Won’t be provided</td>
</tr>
<tr>
<td>auth_time</td>
<td>Will always be provided</td>
</tr>
</tbody></table>
<h5 id='user-info-response-specification'>User info Response Specification</h5>
<p>The content type of the response will be <code>application/jwt</code>. The response will be signed and encrypted by BMID using the signing and encryption certificate exposed. The itsme Back-End replies with the Identity Data that were requested in the Authorization Request.
<aside class="success">What is the lay-out of the Identity Data that BMID obtain in the Userinfo Response? They are the same as on the eID card </aside>
<aside class="success">What format does the certificate need to be?
It needs to be in ZIP file, X509 format (cer or crt). Pem file is not supported.  </aside></p>
<h5 id='user-info-response-example'>User info Response Example</h5>
<p>(Not encrypted nor signed)</p>
<pre class="highlight http tab-http--inline"><code><span class="err"> </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="s"> Content-Type: application/json</span>

 {
    "sub": "248289761001",
    "name": "Jane Doe",
    "email": "janedoe@example.com"
 }
</code></pre><h5 id='user-info-errors'>User info Errors</h5>
<p>When an error condition occurs, the UserInfo Endpoint returns an Error Response as defined in Section 3 of  <a href="https://tools.ietf.org/html/rfc6750">OAuth 2.0 Bearer Token Usage RFC6750</a>   (HTTP errors unrelated to RFC 6750 are returned to the User Agent using the appropriate HTTP status code.)</p>

<p>The following is a non-normative example of a UserInfo Error Response:
<code>http--inline
  HTTP/1.1 401 Unauthorized
  WWW-Authenticate: error=&quot;invalid_token&quot;,
    error_description=&quot;The Access Token expired&quot;
</code></p>
<h4 id='token-endpoint'>Token Endpoint</h4>
<p>As per specified by OIDC, when using the authorization code flow to obtain an Access Token and an ID Token, you will send a token request to token endpoint to have a token response.
If you declared  claims in the <code>id_Token</code> part of the <code>claims</code> parameter in the <code>request</code> object,  you will receive the end user data from the Token Endpoint.</p>
<h5 id='token-endpoint-specs'>Token Endpoint Specs</h5>
<p>To get further information about token types, token request/response specifications please proceed with <a href="#tokenEndpoint">3.2 Token Endpoint</a>.</p>
<h5 id='example-of-id-token-containing-claims'>Example of Id Token Containing “claims”</h5>
<p><em>Will be provided soon</em></p>
<h1 id='4-appendixes'>4. Appendixes</h1>
<p><a name="Appendix"></a> </p>
<h2 id='4-1-passing-request-parameters-as-jwts'>4.1. Passing Request Parameters as JWTs</h2>
<p><a name="JWTRequest"></a></p>

<p>As per specified by OIDC <a href="https://openid.net/specs/openid-connect-core-1_0.html#JWTRequests">here</a>, Authorization Request parameters to enable Authentication Requests to be signed and optionally encrypted are explained.</p>

<p>The Request Object is a JWT token as defined in <a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>, which contains at least the following properties:</p>

<table><thead>
<tr>
<th>Property</th>
<th>Required</th>
<th>Comment</th>
</tr>
</thead><tbody>
<tr>
<td><strong>iss</strong></td>
<td>Required</td>
<td>Specifies the issuing authority. Issuer of the id_tokenIssuer. Must be the <code>client_id</code></td>
</tr>
<tr>
<td><strong>aud</strong></td>
<td>Required</td>
<td>Audience. MUST be the Token Endpoint URL</td>
</tr>
</tbody></table>

<p>Example of claim request before base64url encoding, signing and encryption. In this example, the partner is using the login service.</p>
<pre class="highlight json tab-json--inline"><code><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">JWT</span><span class="w"> </span><span class="err">Registered</span><span class="w"> </span><span class="err">claims</span><span class="w"> </span><span class="err">(https</span><span class="p">:</span><span class="err">//tools.ietf.org/html/rfc</span><span class="mi">7519</span><span class="err">#section</span><span class="mf">-4.1</span><span class="err">)</span><span class="w">
    </span><span class="err">iss</span><span class="p">:</span><span class="w"> </span><span class="s2">"s6BhdRkqt3"</span><span class="p">,</span><span class="w">
    </span><span class="err">aud</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://server.itsme.be"</span><span class="p">,</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">OIDC</span><span class="w"> </span><span class="err">parameters</span><span class="p">,</span><span class="w"> </span><span class="err">must</span><span class="w"> </span><span class="err">reflect</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">values</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">HTTP</span><span class="w"> </span><span class="err">parameters</span><span class="w">
    </span><span class="err">client_id</span><span class="p">:</span><span class="w"> </span><span class="s2">"s6BhdRkqt3"</span><span class="p">,</span><span class="w">
    </span><span class="err">response_type</span><span class="p">:</span><span class="w"> </span><span class="s2">"code"</span><span class="p">,</span><span class="w">
    </span><span class="err">redirect_uri</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://client.example.org/cb"</span><span class="p">,</span><span class="w">
    </span><span class="err">scope</span><span class="p">:</span><span class="w"> </span><span class="s2">"openid email service:PARTNER_LOGIN"</span><span class="p">,</span><span class="w">
    </span><span class="err">state</span><span class="p">:</span><span class="w"> </span><span class="s2">"af0ifjsldkj"</span><span class="p">,</span><span class="w">
    </span><span class="err">nonce</span><span class="p">:</span><span class="w"> </span><span class="s2">"n-0S6_WzA2Mj"</span><span class="p">,</span><span class="w">
    </span><span class="err">claims</span><span class="p">:</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="err">userinfo</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="s2">"tag:itsmetag:sixdots.be,2016-06:claim_nationality"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="err">id_token</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="err">auth_time</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"essential"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span><span class="w">
            </span><span class="err">acr</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="err">\</span><span class="p">[</span><span class="s2">"tag:itsmetag:sixdots.be,2016-06:acr_advanced"</span><span class="err">\</span><span class="p">]</span><span class="w">       
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></code></pre><h2 id='4-2-requests-signing-and-encryption'>4.2. Requests Signing and Encryption</h2>
<p>Encryption algorithm used: RSA SHA-256</p>

<p>Supported algorithms and encryption methods for:
- ID Token
-- Encryption Method (enc): A128CBC-HS256
-- Encryption Algorithm (alg): RSA-OAEP
-- Signing Algorithm (alg): RS256
- User Info
-- Encryption Method (enc): A128CBC-HS256
-- Encryption Algorithm (alg): RSA-OAEP
-- Signing Algorithm (alg):  RS256
- Request Object
-- Encryption Method (enc): A128CBC-HS256
-- Encryption Algorithm (alg): RSA-OAEP
-- Signing Algorithm (alg): RS256</p>

<p>Offline access is not supported. </p>

<p>Dynamic client registration is not allowed.</p>

<p>itsme(r) exposes its signing and encryption keys on a public endpoint (JWKSet) 
https://merchant.itsme.be/oidc/jwkSet</p>

<p>It is expected that you will also expose their signing and encryption keys in such a way. The location of your JWKSet must be configured by an  administrator of BMID during your on-boarding. The exposed endpoint must be HTTPS.</p>
<h2 id='4-3-universal-links-on-ios'>4.3. Universal Links on iOS</h2>
<p>Integration is going to be pretty straightforward, all details can be found in below steps (as documented on <a href="https://developer.apple.com/ios/universal-links/">Universal Links official documentation</a>):
1. Register your app at developer.apple.com
2. Enable ‘Associated Domains’ on your app identifier
3. Enable ‘Associated Domain’ on in your Xcode project
4. Add the proper domain entitlement and make sure the entitlements file is included at build: Xcode will do it automatically by itself.
5. Create the ‘apple-app-site-association’ file (AASA). The AASA file contains a JSON object with a list of apps and the URL paths on the domain that should be included or excluded as Universal Links. Here is a sample AASA file:</p>
<pre class="highlight plaintext"><code>{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": “JHGFJHHYX.com.facebook.ios",
        "paths": [
          "*"
        ]
      }
    ]
  }
} 
</code></pre>
<p>The JSON object will contain </p>

<table><thead>
<tr>
<th style="text-align: left">Parameter</th>
<th style="text-align: left">Description</th>
</tr>
</thead><tbody>
<tr>
<td style="text-align: left">appID</td>
<td style="text-align: left">Built by combining your app’s Team ID (it should be retrieved from https://developer.apple.com/account/#/membership/) and the Bundle Identifier. In the example attached, JHGFJHHYX is the Team ID and com.facebook.ios is the Bundle ID.</td>
</tr>
<tr>
<td style="text-align: left">paths</td>
<td style="text-align: left">Array of strings that specify which paths are included or excluded from association. Note: these strings are case sensitive and that query strings and fragment identifiers are ignored.</td>
</tr>
</tbody></table>

<ol>
<li>Upload the ‘apple-app-site-association’ file to your HTTPS web server for the redirection URI communicated in the Authentication request. The file can be placed at the root of your server or in the .well-known subdirectory.</li>
</ol>

<aside class="notice"> While hosting the AASA file, please ensure that the AASA file:
<ul>
  <li>
    is served over HTTPS.
  </li>
  <li>
    uses application/json MIME type.
  </li>
  <li>
    don’t append .json to the apple-app-site-association filename.
  </li>
  <li>
    has a size not exceeding 128 Kb (requirement in iOS 9.3.1 onwards)
  </li>
</aside>

<ol>
<li>Check if the AASA file is valid and is accessible by using the <a href="https://branch.io/resources/aasa-validator/#resultsbox">following link</a></li>
<li>Add an entitlement to all redirect URI that the your app need to supports. In Xcode, open the Associated Domains section in the Capabilities tab and add an entry for each Redirect URI that your app supports, prefixed with <code>applinks</code>.
<aside class="notice">Apple doc says to limit this list to no more than about 20 to 30 domains<aside></li>
</ol>

<p>To match all subdomains of an associated redirect URI, you can specify a wildcard by prefixing <code>*.</code> before the beginning of a specific Redirect URI (the period is required). Redirect URI matching is based on the longest substring in the <code>applinks</code> entries. For example, if you specify the entries <code>applinks:*.mywebsite.com</code> and <code>applinks:*.users.mywebsite.com</code>, matching for the redirect URI <code>emily.users.mywebsite.com</code> is performed against the longer <code>*.users.mywebsite.com</code> entry. Note that an entry for <code>*.mywebsite.com</code> does not match <code>mywebsite.com</code> because of the period after the asterisk. To enable matching for both <code>*.mywebsite.com</code> and <code>mywebsite.com</code>, you need to provide a separate <code>applinks</code> entry for each.</p>

<ol>
<li>Update the app delegate to respond appropriately when it receives the <code>NSUserActivity</code> object. After all above steps are completed perfectly, when the User click a universal link, the app will open up and the method <code>application:continueUserActivity:restorationHandler</code> will get called in <code>Appdelegate</code>. When iOS launches the the app after a User taps a universal link, you receive an <code>NSUserActivity</code> object with an <code>activityType</code> value of <code>NSUserActivityTypeBrowsingWeb</code>. The activity object’s <code>webpageURL</code> property contains the redirect URI that the user is accessing. The webpage URL property always contains an HTTPS URL, and you can use <code>NSURLComponents</code> APIs to manipulate the components of the URL.</li>
</ol>
<pre class="highlight http tab-http--inline"><code><span class="err">func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([Any]?) -&gt; Void) -&gt; Bool {
    print("Continue User Activity called: ")
    if userActivity.activityType == NSUserActivityTypeBrowsingWeb {
        let url = userActivity.webpageURL!
        print(url.absoluteString)
        //handle url and open whatever page you want to open.
    }
    return true
}
</span></code></pre>
<p>For getting the URL parameters, use the following function:</p>
<pre class="highlight http tab-http--inline"><code><span class="err">//playground code..
var str = “https://google.com/contents/someotherpath?category=series&amp;contentid=1562167825"
let url = URL(string: str)
func queryParameters(from url: URL) -&gt; [String: String] {
let urlComponents = URLComponents(url: url, resolvingAgainstBaseURL: false)
var queryParams = [String: String]()
for queryItem: URLQueryItem in (urlComponents?.queryItems)! {
if queryItem.value == nil {
continue
}
queryParams[queryItem.name] = queryItem.value
}
return queryParams
}
// print the url parameters dictionary
print(queryParameters(from: url!))

//It will print [“category”: “series”, “contentid”: “1562167825”]
</span></code></pre>
<p>Also if you want to check if the app had opened by clicking a universal link or not in the <code>didFinishLaunchingWithOptions</code> method:</p>
<pre class="highlight http tab-http--inline"><code><span class="err">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey : Any]? = nil) -&gt; Bool {
 var isUniversalLinkClick: Bool = false
 if launchOptions[UIApplicationLaunchOptionsUserActivityDictionaryKey] {
 let activityDictionary = launchOptions[UIApplicationLaunchOptionsUserActivityDictionaryKey] as? [AnyHashable: Any] ?? [AnyHashable: Any]()
 let activity = activityDictionary[“UIApplicationLaunchOptionsUserActivityKey”] as? NSUserActivity ?? NSUserActivity()
 if activity != nil {
 isUniversalLinkClick = true
 }
 }
 if isUniversalLinkClick {
 // app opened via clicking a universal link.
 } else {
 // set the initial viewcontroller
 }
 return true
}
</span></code></pre><h2 id='4-4-app-links-on-android'>4.4. App Links on Android</h2>
<p>The App Links Assistant in Android Studio can help you create intent filters in your manifest and map existing URLs from your website to activities in your app. Follow below steps to configure the App links (as documented on <a href="https://developer.android.com/studio/write/app-link-indexing">App Links official documentation</a>):</p>

<ol>
<li>Add the intent filters to your manifest. Go through the your manifest and select Tools &gt; App Links Assistant. Click Open URL Mapping Editor and then click Add  at the bottom of the URL Mapping list to add a new URL mapping.</li>
<li>Add details for the new URL mapping:

<ul>
<li>Entering your redirect URI in the <code>host</code> field </li>
<li>Add a <code>path</code>, <code>pathPrefix</code>, or <code>pathPattern</code> for the redirect URIs you want to map. For example, if you have a recipe-sharing app, with all the recipes available in the same activity, and your corresponding website&#39;s recipes are all in the same <code>/recipe directory</code>, use <code>pathPrefix</code> and enter <code>/recipe</code>. This way, the redirect URI http://www.recipe-app.com/recipe/grilled-potato-salad maps to the activity you select in the following step.</li>
<li>Select the Activity the redirect URI should take users to.</li>
<li>Click OK.</li>
</ul></li>
<li>The App Links Assistant adds intent filters based on your URL mapping to the <code>AndroidManifest.xml</code> file, and highlights it in the <code>Preview</code> field. If the you would like to make any changes, click Open <code>AndroidManifest.xml</code> to edit the intent filter.</li>
</ol>

<aside class="notice">To support more links without updating the app, you should define a URL mapping that supports redirect URIs that he will add in the future. </aside>

<ol>
<li>To verify the URL mapping works properly, enter a URL in the Check URL Mapping field and click Check Mapping. If it&#39;s working correctly, the success message shows that the URL entered maps to the activity you selected.</li>
<li>Handle incoming links. Once you have verified that the URL mapping is working correctly, you MUST add the logic to handle the intent he created.

<ul>
<li>Click Select Activity from the App Links Assistant.</li>
<li>Select an activity from the list and click Insert Code.
The App Links Assistant adds code to the activity&#39;s Java file, similar to the following:
<code>
// ATTENTION: This was auto-generated to handle app links.
Intent appLinkIntent = getIntent();
String appLinkAction = appLinkIntent.getAction();
Uri appLinkData = appLinkIntent.getData();
</code>
However, this code isn&#39;t complete on its own. You MUST now take an action based on the URI in <appLinkData>, such as display the corresponding content. For example, for the recipe-sharing app, the code might look like the following sample:</li>
</ul></li>
</ol>
<pre class="highlight plaintext"><code>  protected void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  ...
  handleIntent(getIntent());
}

protected void onNewIntent(Intent intent) {
  super.onNewIntent(intent);
  handleIntent(intent);
}

private void handleIntent(Intent intent) {
    String appLinkAction = intent.getAction();
    Uri appLinkData = intent.getData();
    if (Intent.ACTION_VIEW.equals(appLinkAction) &amp;&amp; appLinkData != null){
        String recipeId = appLinkData.getLastPathSegment();
        Uri appData = Uri.parse("content://com.recipe_app/recipe/").buildUpon()
            .appendPath(recipeId).build();
        showRecipe(appData);
    }
}
</code></pre>
<ol>
<li>Associate the app with the redirect URI. After setting up URL support for your app, the App Links Assistant generates a Digital Asset Links file you can use to associate his website with your app. As an alternative to using the Digital Asset Links file, you can associate your site and app in Search Console. To associate the app and the website using the App Links Assistant, click Open the Digital Asset Links File Generator from the App Links Assistant and follow these steps:

<ul>
<li>Enter your Site domain and Application ID.</li>
<li>To include support in your Digital Asset Links file for Smart Lock for Passwords, select Support sharing credentials between the app and the website and enter your site&#39;s login URL. This adds the following string to your Digital Asset Links file declaring that your app and website share sign-in credentials: <code>delegate_permission/common.get_login_creds</code>.</li>
<li>Specify the signing config or select a keystore file. Make sure to select the right config or keystore file for either the release build or debug build of your app. If you want to set up his production build, use the release config. If you want to test his build, use the debug config.</li>
<li>Click <code>Generate Digital Asset Links</code> file.</li>
<li>Once Android Studio generates the file, click <code>Save file</code> to download it.</li>
<li>Upload the <code>assetlinks.json</code> file to redirect URI site, with read-access for everyone, at <code>https://&lt;yoursite&gt;/.well-known/assetlinks.json</code>.</li>
</ul></li>
</ol>

<aside class="notice">The system verifies the Digital Asset Links file via the encrypted HTTPS protocol. Make sure that the assetlinks.json file is accessible over an HTTPS connection, regardless of whether your app's intent filter includes https</aside>

<ul>
<li>Click <Link and Verify> to confirm that you&#39;ve uploaded the correct Digital Asset Links file to the correct location.</li>
</ul>

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTkyNDAxNDExNywxMzc4MTU5MDU1LDUzND
U2NDc3MywxMjA0MDY2Mzc4LDE1NDM0MTExNTQsLTY2OTk5OTIw
OCwtNjIyMTI5MDMsOTY2MzYwNjQ3LDE4MTEzNzMzNSwxNDEwNz
g5MTA1LC0xNzU4NzQ0MjcsMTAxNTE2Mzg2NywtMTM3MDU4NjIy
OSw0NDUxMzg3MDgsMjEyNzY5MTEzNCwtMTc1NDgwMjQ0OSwxNz
M0NDE5NDM0LC0xNjMzNDM5ODEzLC0xNDU0ODMxMTg4LC01Nzk3
MDE3MjNdfQ==
-->

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTc5MTgxMTAwNl19
-->

<!--stackedit_data:
eyJoaXN0b3J5IjpbNjI1ODcyNDI4LC00MTYxMTEyNTIsNTQ2ND
UzOTUzLDEwNzcxNDQzMzUsOTkwODM1NDc1LDMxMzEwMjAzNyw0
MzI5MzIxOTYsLTE1MTQwMDM3MTgsMzc1MDYwMDEzLC0xOTE3NT
g5MjExLDIxMTQ4ODY5NCwtMTM3MjIzNjE0NSw3OTI2NzA0NzMs
LTE5NDA2NDc3MjIsMTM3OTI2ODA2OSw2NTYwOTIwMjgsLTIwOT
MzNTI3OTgsMTM1NzAwMDU4Nl19
-->

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">JSON</a>
                <a href="#" data-language-name="http">HTTP</a>
          </div>
      </div>
    </div>
  </body>
</html>
